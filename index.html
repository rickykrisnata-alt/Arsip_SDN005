<!DOCTYPE html>
<html lang="id" x-data="{ sidebarOpen: false, currentPage: 'dashboard', userRole: 'admin' }">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Kearsipan Surat - SDN 005</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="assets/js/app.js"></script>
    <style>
        [x-cloak] { display: none !important; }
        .sidebar-transition { transition: transform 0.3s ease-in-out; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Custom color palette - Eyes Friendly */
        :root {
            --primary: #14b8a6;      /* Soft teal */
            --primary-light: #2dd4bf;
            --primary-dark: #0d9488;
            --secondary: #06b6d4;    /* Soft blue */
            --secondary-light: #0284c7;
            --secondary-dark: #075985;
            --accent: #8b5cf6;       /* Soft purple */
            --accent-light: #a78bfa;
            --accent-dark: #7c3aed;
            --success: #10b981;      /* Soft green */
            --success-light: #34d399;
            --success-dark: #059669;
            --warning: #f59e0b;      /* Soft amber */
            --warning-light: #fbbf24;
            --warning-dark: #d97706;
            --danger: #ef4444;        /* Soft red */
            --danger-light: #f87171;
            --danger-dark: #dc2626;
            --neutral-50: #f9fafb;
            --neutral-100: #f3f4f6;
            --neutral-200: #e5e7eb;
            --neutral-300: #d1d5db;
            --neutral-400: #9ca3af;
            --neutral-500: #64748b;
            --neutral-600: #475569;
            --neutral-700: #334155;
            --neutral-800: #1e293b;
            --neutral-900: #0f172a;
            --white: #ffffff;
        }
        
        /* Dark Sidebar Styles */
        .sidebar-desktop {
            display: none;
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            border-right: 1px solid rgba(55, 65, 81, 0.5);
            box-shadow: 4px 0 6px -1px rgba(0, 0, 0, 0.3), 2px 4px -2px rgba(0, 0, 0, 0.2);
        }
        
        @media (min-width: 1024px) {
            .sidebar-desktop {
                display: block;
            }
        }
        
        /* Mobile Sidebar - Dark Theme */
        .sidebar-mobile {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            border-right: 1px solid rgba(55, 65, 81, 0.5);
        }
        
        /* Scrollable sidebar */
        .sidebar-scrollable {
            height: calc(100vh - 4rem);
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        /* Custom Dark Scrollbar */
        .sidebar-scrollable::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar-scrollable::-webkit-scrollbar-track {
            background: rgba(17, 24, 39, 0.5);
        }
        
        .sidebar-scrollable::-webkit-scrollbar-thumb {
            background: rgba(75, 85, 99, 0.8);
            border-radius: 3px;
        }
        
        .sidebar-scrollable::-webkit-scrollbar-thumb:hover {
            background: rgba(107, 114, 128, 0.9);
        }
        
        .sidebar-scrollable::-webkit-scrollbar-thumb:active {
            background: rgba(156, 163, 175, 0.9);
        }
        
        /* Card styles */
        .card {
            background: var(--white);
            border: 1px solid var(--neutral-200);
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            transition: all 0.2s ease-in-out;
        }
        
        .card:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transform: translateY(-2px);
        }
        
        /* Button styles */
        .btn-primary {
            background: var(--primary);
            color: var(--white);
            border-radius: 0.5rem;
            padding: 0.625rem 1.25rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            border: none;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: var(--white);
            color: var(--neutral-700);
            border: 1px solid var(--neutral-300);
            border-radius: 0.5rem;
            padding: 0.625rem 1.25rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
        }
        
        .btn-secondary:hover {
            background: var(--neutral-50);
            border-color: var(--neutral-400);
            color: var(--neutral-800);
        }
        
        /* Dark sidebar menu styles */
        .sidebar-menu-item {
            color: #d1d5db;
            transition: all 0.2s ease;
        }
        
        .sidebar-menu-item:hover {
            background: rgba(55, 65, 81, 0.5);
            color: #f3f4f6;
        }
        
        .sidebar-menu-item.active {
            background: rgba(20, 184, 166, 0.2);
            color: #14b8a6;
            border-right: 2px solid #14b8a6;
        }
        
        .sidebar-submenu {
            color: #9ca3af;
            transition: all 0.2s ease;
        }
        
        .sidebar-submenu:hover {
            background: rgba(55, 65, 81, 0.3);
            color: #e5e7eb;
        }
        
        .sidebar-submenu.active {
            background: rgba(20, 184, 166, 0.1);
            color: #14b8a6;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Header -->
    <header class="bg-white border-b border-neutral-200 fixed top-0 left-0 right-0 z-40">
        <div class="px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <button @click="sidebarOpen = !sidebarOpen" class="p-2 rounded-md text-neutral-600 hover:text-neutral-900 hover:bg-neutral-100 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 lg:hidden">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <div class="flex-shrink-0 flex items-center ml-4 lg:ml-0">
                        <i class="fas fa-school text-primary text-2xl mr-3"></i>
                        <div>
                            <h1 class="text-xl font-bold text-neutral-900">Sistem Kearsipan Surat</h1>
                            <p class="text-xs text-neutral-500">SDN 005</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative" x-data="{ notificationOpen: false }">
                        <button @click="notificationOpen = !notificationOpen" class="p-2 rounded-full text-neutral-600 hover:text-neutral-900 hover:bg-neutral-100 relative">
                            <i class="fas fa-bell text-lg"></i>
                            <span class="absolute top-0 right-0 block h-2 w-2 rounded-full bg-danger"></span>
                        </button>
                        <div x-show="notificationOpen" @click.away="notificationOpen = false" x-cloak
                             x-transition:enter="transition ease-out duration-200"
                             x-transition:enter-start="opacity-0 transform scale-95"
                             x-transition:enter-end="opacity-100 transform scale-100"
                             class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-neutral-200 z-50">
                            <div class="p-4 border-b border-neutral-200">
                                <h3 class="text-sm font-medium text-neutral-900">Notifikasi</h3>
                            </div>
                            <div class="max-h-64 overflow-y-auto">
                                <div class="p-3 hover:bg-neutral-50 cursor-pointer border-b border-neutral-100">
                                    <p class="text-sm text-neutral-900">Surat masuk baru dari Dinas Pendidikan</p>
                                    <p class="text-xs text-neutral-500 mt-1">2 jam yang lalu</p>
                                </div>
                                <div class="p-3 hover:bg-neutral-50 cursor-pointer">
                                    <p class="text-sm text-neutral-900">Template surat baru ditambahkan</p>
                                    <p class="text-xs text-neutral-500 mt-1">1 hari yang lalu</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="relative" x-data="{ profileOpen: false }">
                        <button @click="profileOpen = !profileOpen" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-neutral-100">
                            <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center">
                                <span class="text-white text-sm font-medium" x-text="userRole === 'admin' ? 'A' : userRole === 'pimpinan' ? 'P' : 'U'"></span>
                            </div>
                            <span class="hidden md:block text-sm font-medium text-neutral-700" x-text="userRole === 'admin' ? 'Admin' : userRole === 'pimpinan' ? 'Pimpinan' : 'User'"></span>
                            <i class="fas fa-chevron-down text-xs text-neutral-500"></i>
                        </button>
                        <div x-show="profileOpen" @click.away="profileOpen = false" x-cloak
                             x-transition:enter="transition ease-out duration-200"
                             x-transition:enter-start="opacity-0 transform scale-95"
                             x-transition:enter-end="opacity-100 transform scale-100"
                             class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-neutral-200 z-50">
                            <a href="#" class="block px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">
                                <i class="fas fa-user mr-2"></i> Profil
                            </a>
                            <a href="#" class="block px-4 py-2 text-sm text-neutral-700 hover:bg-neutral-100">
                                <i class="fas fa-cog mr-2"></i> Pengaturan
                            </a>
                            <hr class="my-1 border-neutral-200">
                            <a href="#" @click="logout()" class="block px-4 py-2 text-sm text-danger hover:bg-red-50">
                                <i class="fas fa-sign-out-alt mr-2"></i> Keluar
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Sidebar -->
    <aside x-show="sidebarOpen" 
           x-cloak
           x-transition:enter="transition ease-out duration-200"
           x-transition:enter-start="opacity-0 transform -translate-x-full"
           x-transition:enter-end="opacity-100 transform translate-x-0"
           x-transition:leave="transition ease-in duration-200"
           x-transition:leave-start="opacity-100 transform translate-x-0"
           x-transition:leave-end="opacity-0 transform -translate-x-full"
           class="fixed inset-y-0 left-0 z-50 w-64 sidebar-mobile shadow-xl lg:hidden">
        <div class="flex flex-col h-full pt-16">
            <nav class="flex-1 px-4 py-6 space-y-2 sidebar-scrollable">
                <!-- Dashboard -->
                <div x-data="{ dashboardOpen: false }">
                    <button @click="dashboardOpen = !dashboardOpen; currentPage = 'dashboard'; sidebarOpen = false"
                           :class="currentPage === 'dashboard' ? 'sidebar-menu-item active' : 'sidebar-menu-item'"
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                        <i class="fas fa-tachometer-alt mr-3 w-5"></i>
                        <span class="flex-1 text-left">Dashboard</span>
                        <i :class="dashboardOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="dashboardOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'dashboard-quick'; sidebarOpen = false"
                           :class="currentPage === 'dashboard-quick' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-bolt mr-2 text-xs"></i>Quick Akses
                        </a>
                    </div>
                </div>

                <!-- Buat Surat -->
                <div x-data="{ buatSuratOpen: false }">
                    <button @click="buatSuratOpen = !buatSuratOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item"
                           x-show="['admin', 'user'].includes(userRole)">
                        <i class="fas fa-plus-circle mr-3 w-5"></i>
                        <span class="flex-1 text-left">Buat Surat</span>
                        <i :class="buatSuratOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="buatSuratOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <div x-data="{ buatSuratKeluarOpen: false }">
                            <button @click="buatSuratKeluarOpen = !buatSuratKeluarOpen; currentPage = 'buat-surat-keluar'; sidebarOpen = false"
                                   :class="currentPage === 'buat-surat-keluar' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="w-full flex items-center px-3 py-2 text-sm rounded">
                                <i class="fas fa-file-alt mr-2 text-xs"></i>
                                <span class="flex-1 text-left">Buat Surat Keluar</span>
                                <i :class="buatSuratKeluarOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                            </button>
                            <div x-show="buatSuratKeluarOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                                <div class="px-3 py-2 text-xs text-gray-400">
                                    • Menggunakan template surat
                                </div>
                                <div class="px-3 py-2 text-xs text-gray-400">
                                    • Template dipilih melalui dropdown
                                </div>
                                <div class="px-3 py-2 text-xs text-gray-400" x-show="userRole === 'admin'">
                                    • Template dapat ditambah dan dikelola oleh Admin
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Agenda Surat -->
                <div x-data="{ agendaSuratOpen: false }">
                    <button @click="agendaSuratOpen = !agendaSuratOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-book mr-3 w-5"></i>
                        <span class="flex-1 text-left">Agenda Surat</span>
                        <i :class="agendaSuratOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="agendaSuratOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <!-- Surat Masuk -->
                        <div x-data="{ suratMasukOpen: false }">
                            <button @click="suratMasukOpen = !suratMasukOpen" 
                                   class="w-full flex items-center px-3 py-2 text-sm rounded sidebar-submenu">
                                <i class="fas fa-envelope-open-text mr-2 text-xs"></i>
                                <span class="flex-1 text-left">Masuk</span>
                                <i :class="suratMasukOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                            </button>
                            <div x-show="suratMasukOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                                <a href="#" @click="currentPage = 'agenda-masuk-upload'; sidebarOpen = false"
                                   :class="currentPage === 'agenda-masuk-upload' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="block px-3 py-2 text-sm rounded">
                                    <i class="fas fa-upload mr-2 text-xs"></i>Upload berkas surat masuk
                                </a>
                                <a href="#" @click="currentPage = 'agenda-masuk-disposisi'; sidebarOpen = false"
                                   :class="currentPage === 'agenda-masuk-disposisi' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="block px-3 py-2 text-sm rounded"
                                   x-show="['admin', 'pimpinan'].includes(userRole)">
                                    <i class="fas fa-stamp mr-2 text-xs"></i>Disposisi surat
                                </a>
                                <a href="#" @click="currentPage = 'agenda-masuk-daftar'; sidebarOpen = false"
                                   :class="currentPage === 'agenda-masuk-daftar' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="block px-3 py-2 text-sm rounded">
                                    <i class="fas fa-list mr-2 text-xs"></i>Daftar Surat Masuk
                                </a>
                            </div>
                        </div>

                        <!-- Surat Keluar -->
                        <div x-data="{ suratKeluarOpen: false }">
                            <button @click="suratKeluarOpen = !suratKeluarOpen" 
                                   class="w-full flex items-center px-3 py-2 text-sm rounded sidebar-submenu">
                                <i class="fas fa-paper-plane mr-2 text-xs"></i>
                                <span class="flex-1 text-left">Keluar</span>
                                <i :class="suratKeluarOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                            </button>
                            <div x-show="suratKeluarOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                                <a href="#" @click="currentPage = 'agenda-keluar-upload'; sidebarOpen = false"
                                   :class="currentPage === 'agenda-keluar-upload' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="block px-3 py-2 text-sm rounded">
                                    <i class="fas fa-upload mr-2 text-xs"></i>Upload berkas surat keluar
                                </a>
                                <a href="#" @click="currentPage = 'agenda-keluar-daftar'; sidebarOpen = false"
                                   :class="currentPage === 'agenda-keluar-daftar' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="block px-3 py-2 text-sm rounded">
                                    <i class="fas fa-list mr-2 text-xs"></i>Daftar Surat Keluar
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Arsip -->
                <div x-data="{ arsipOpen: false }">
                    <button @click="arsipOpen = !arsipOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-archive mr-3 w-5"></i>
                        <span class="flex-1 text-left">Arsip</span>
                        <i :class="arsipOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="arsipOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'arsip-register'; sidebarOpen = false"
                           :class="currentPage === 'arsip-register' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-folder-plus mr-2 text-xs"></i>Register Arsip
                        </a>
                        <a href="#" @click="currentPage = 'arsip-daftar'; sidebarOpen = false"
                           :class="currentPage === 'arsip-daftar' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-folder-open mr-2 text-xs"></i>Daftar Arsip
                        </a>
                    </div>
                </div>

                <!-- Tentang Aplikasi -->
                <div x-data="{ tentangOpen: false }">
                    <button @click="tentangOpen = !tentangOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-info-circle mr-3 w-5"></i>
                        <span class="flex-1 text-left">Tentang Aplikasi</span>
                        <i :class="tentangOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="tentangOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'tentang-info'; sidebarOpen = false"
                           :class="currentPage === 'tentang-info' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-question-circle mr-2 text-xs"></i>Info Penggunaan
                        </a>
                        <a href="#" @click="currentPage = 'tentang-feedback'; sidebarOpen = false"
                           :class="currentPage === 'tentang-feedback' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-comment-dots mr-2 text-xs"></i>Feedback / Kontak / Masukan
                        </a>
                        <a href="#" @click="logout(); sidebarOpen = false"
                           class="block px-3 py-2 text-sm rounded sidebar-submenu">
                            <i class="fas fa-sign-out-alt mr-2 text-xs"></i>Logout
                        </a>
                    </div>
                </div>
            </nav>
        </div>
    </aside>

    <!-- Desktop Sidebar -->
    <aside class="sidebar-desktop fixed inset-y-0 left-0 z-30 w-64">
        <div class="flex flex-col h-full pt-16">
            <nav class="flex-1 px-4 py-6 space-y-2 sidebar-scrollable">
                <!-- Dashboard -->
                <div x-data="{ dashboardOpen: false }">
                    <button @click="dashboardOpen = !dashboardOpen; currentPage = 'dashboard'"
                           :class="currentPage === 'dashboard' ? 'sidebar-menu-item active' : 'sidebar-menu-item'"
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                        <i class="fas fa-tachometer-alt mr-3 w-5"></i>
                        <span class="flex-1 text-left">Dashboard</span>
                        <i :class="dashboardOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="dashboardOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'dashboard-quick'"
                           :class="currentPage === 'dashboard-quick' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-bolt mr-2 text-xs"></i>Quick Akses
                        </a>
                    </div>
                </div>

                <!-- Buat Surat -->
                <div x-data="{ buatSuratOpen: false }">
                    <button @click="buatSuratOpen = !buatSuratOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item"
                           x-show="['admin', 'user'].includes(userRole)">
                        <i class="fas fa-plus-circle mr-3 w-5"></i>
                        <span class="flex-1 text-left">Buat Surat</span>
                        <i :class="buatSuratOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="buatSuratOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <div x-data="{ buatSuratKeluarOpen: false }">
                            <button @click="buatSuratKeluarOpen = !buatSuratKeluarOpen; currentPage = 'buat-surat-keluar'"
                                   :class="currentPage === 'buat-surat-keluar' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="w-full flex items-center px-3 py-2 text-sm rounded">
                                <i class="fas fa-file-alt mr-2 text-xs"></i>
                                <span class="flex-1 text-left">Buat Surat Keluar</span>
                                <i :class="buatSuratKeluarOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                            </button>
                            <div x-show="buatSuratKeluarOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                                <div class="px-3 py-2 text-xs text-gray-400">
                                    • Menggunakan template surat
                                </div>
                                <div class="px-3 py-2 text-xs text-gray-400">
                                    • Template dipilih melalui dropdown
                                </div>
                                <div class="px-3 py-2 text-xs text-gray-400" x-show="userRole === 'admin'">
                                    • Template dapat ditambah dan dikelola oleh Admin
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Agenda Surat -->
                <div x-data="{ agendaSuratOpen: false }">
                    <button @click="agendaSuratOpen = !agendaSuratOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-book mr-3 w-5"></i>
                        <span class="flex-1 text-left">Agenda Surat</span>
                        <i :class="agendaSuratOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="agendaSuratOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <!-- Surat Masuk -->
                        <div x-data="{ suratMasukOpen: false }">
                            <button @click="suratMasukOpen = !suratMasukOpen" 
                                   class="w-full flex items-center px-3 py-2 text-sm rounded sidebar-submenu">
                                <i class="fas fa-envelope-open-text mr-2 text-xs"></i>
                                <span class="flex-1 text-left">Masuk</span>
                                <i :class="suratMasukOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                            </button>
                            <div x-show="suratMasukOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                                <a href="#" @click="currentPage = 'agenda-masuk-upload'"
                                   :class="currentPage === 'agenda-masuk-upload' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="block px-3 py-2 text-sm rounded">
                                    <i class="fas fa-upload mr-2 text-xs"></i>Upload berkas surat masuk
                                </a>
                                <a href="#" @click="currentPage = 'agenda-masuk-disposisi'"
                                   :class="currentPage === 'agenda-masuk-disposisi' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="block px-3 py-2 text-sm rounded"
                                   x-show="['admin', 'pimpinan'].includes(userRole)">
                                    <i class="fas fa-stamp mr-2 text-xs"></i>Disposisi surat
                                </a>
                                <a href="#" @click="currentPage = 'agenda-masuk-daftar'"
                                   :class="currentPage === 'agenda-masuk-daftar' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="block px-3 py-2 text-sm rounded">
                                    <i class="fas fa-list mr-2 text-xs"></i>Daftar Surat Masuk
                                </a>
                            </div>
                        </div>

                        <!-- Surat Keluar -->
                        <div x-data="{ suratKeluarOpen: false }">
                            <button @click="suratKeluarOpen = !suratKeluarOpen" 
                                   class="w-full flex items-center px-3 py-2 text-sm rounded sidebar-submenu">
                                <i class="fas fa-paper-plane mr-2 text-xs"></i>
                                <span class="flex-1 text-left">Keluar</span>
                                <i :class="suratKeluarOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                            </button>
                            <div x-show="suratKeluarOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                                <a href="#" @click="currentPage = 'agenda-keluar-upload'"
                                   :class="currentPage === 'agenda-keluar-upload' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="block px-3 py-2 text-sm rounded">
                                    <i class="fas fa-upload mr-2 text-xs"></i>Upload berkas surat keluar
                                </a>
                                <a href="#" @click="currentPage = 'agenda-keluar-daftar'"
                                   :class="currentPage === 'agenda-keluar-daftar' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="block px-3 py-2 text-sm rounded">
                                    <i class="fas fa-list mr-2 text-xs"></i>Daftar Surat Keluar
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Arsip -->
                <div x-data="{ arsipOpen: false }">
                    <button @click="arsipOpen = !arsipOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-archive mr-3 w-5"></i>
                        <span class="flex-1 text-left">Arsip</span>
                        <i :class="arsipOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="arsipOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'arsip-register'"
                           :class="currentPage === 'arsip-register' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-folder-plus mr-2 text-xs"></i>Register Arsip
                        </a>
                        <a href="#" @click="currentPage = 'arsip-daftar'"
                           :class="currentPage === 'arsip-daftar' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-folder-open mr-2 text-xs"></i>Daftar Arsip
                        </a>
                    </div>
                </div>

                <!-- Tentang Aplikasi -->
                <div x-data="{ tentangOpen: false }">
                    <button @click="tentangOpen = !tentangOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-info-circle mr-3 w-5"></i>
                        <span class="flex-1 text-left">Tentang Aplikasi</span>
                        <i :class="tentangOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="tentangOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'tentang-info'"
                           :class="currentPage === 'tentang-info' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-question-circle mr-2 text-xs"></i>Info Penggunaan
                        </a>
                        <a href="#" @click="currentPage = 'tentang-feedback'"
                           :class="currentPage === 'tentang-feedback' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-comment-dots mr-2 text-xs"></i>Feedback / Kontak / Masukan
                        </a>
                        <a href="#" @click="logout()"
                           class="block px-3 py-2 text-sm rounded sidebar-submenu">
                            <i class="fas fa-sign-out-alt mr-2 text-xs"></i>Logout
                        </a>
                    </div>
                </div>
            </nav>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="lg:ml-64 pt-16">
        <div class="px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard Page -->
            <div x-show="currentPage === 'dashboard'" x-cloak class="fade-in">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-neutral-900">Dashboard</h2>
                    <p class="text-neutral-600">Selamat datang di Sistem Kearsipan Surat SDN 005</p>
                </div>

                <!-- Welcome Section -->
                <div class="bg-white rounded-xl shadow-sm border-neutral-200 p-8 mb-8">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-neutral-900">Selamat Datang!</h3>
                            <p class="text-neutral-600">Sistem kearsipan surat digital siap membantu pekerjaan administrasi sekolah Anda.</p>
                        </div>
                        <div class="text-right">
                            <span class="inline-flex items-center px-3 py-1 rounded-full bg-success text-white text-sm font-medium">
                                <i class="fas fa-check-circle mr-2"></i>
                                <span x-text="userRole === 'admin' ? 'Administrator' : userRole === 'pimpinan' ? 'Pimpinan' : 'User'"></span>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <div class="card p-6 hover:shadow-lg cursor-pointer" @click="currentPage = 'buat-surat-keluar'" x-show="['admin', 'user'].includes(userRole)">
                        <div class="flex items-center">
                            <div class="p-3 bg-primary rounded-xl mr-4">
                                <i class="fas fa-plus-circle text-white text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-neutral-900">Buat Surat</h4>
                                <p class="text-sm text-neutral-600">Buat surat keluar dengan template</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card p-6 hover:shadow-lg cursor-pointer" @click="currentPage = 'agenda-masuk-upload'">
                        <div class="flex items-center">
                            <div class="p-3 bg-secondary rounded-xl mr-4">
                                <i class="fas fa-upload text-white text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-neutral-900">Upload Surat Masuk</h4>
                                <p class="text-sm text-neutral-600">Upload surat masuk baru</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card p-6 hover:shadow-lg cursor-pointer" @click="currentPage = 'arsip-register'">
                        <div class="flex items-center">
                            <div class="p-3 bg-accent rounded-xl mr-4">
                                <i class="fas fa-archive text-white text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-neutral-900">Register Arsip</h4>
                                <p class="text-sm text-neutral-600">Daftarkan dokumen</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-xl shadow-sm border-neutral-200 p-8">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-neutral-900">Aktivitas Terkini</h3>
                        <button class="btn-secondary text-sm">
                            <i class="fas fa-sync-alt mr-2"></i>
                            Refresh
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="flex items-start p-4 bg-neutral-50 rounded-lg">
                            <div class="flex-shrink-0">
                                <div class="p-2 bg-success rounded-full">
                                    <i class="fas fa-check text-white text-sm"></i>
                                </div>
                            </div>
                            <div class="ml-4 flex-1">
                                <p class="text-sm font-medium text-neutral-900">Surat masuk baru telah diupload</p>
                                <p class="text-xs text-neutral-500">Dari Dinas Pendidikan</p>
                                <p class="text-xs text-neutral-400">2 jam yang lalu</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start p-4 bg-neutral-50 rounded-lg">
                            <div class="flex-shrink-0">
                                <div class="p-2 bg-warning rounded-full">
                                    <i class="fas fa-clock text-white text-sm"></i>
                                </div>
                            </div>
                            <div class="ml-4 flex-1">
                                <p class="text-sm font-medium text-neutral-900">Menunggu disposisi</p>
                                <p class="text-xs text-neutral-500">5 surat menunggu disposisi</p>
                                <p class="text-xs text-neutral-400">Perlu ditindaklan</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start p-4 bg-neutral-50 rounded-lg">
                            <div class="flex-shrink-0">
                                <div class="p-2 bg-danger rounded-full">
                                    <i class="fas fa-exclamation-triangle text-white text-sm"></i>
                                </div>
                            </div>
                            <div class="ml-4 flex-1">
                                <p class="text-sm font-medium text-neutral-900">Template perlu diperbarui</p>
                                <p class="text-xs text-neutral-500">3 template perlu update</p>
                                <p class="text-xs text-neutral-400">Hubungi admin</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Halaman Buat Surat Keluar -->
            <div x-show="currentPage === 'buat-surat-keluar'" x-cloak class="fade-in">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-neutral-900">Buat Surat Keluar</h2>
                    <p class="text-neutral-600">Buat surat keluar dengan template yang tersedia</p>
                </div>

                <!-- Form dan Preview Container -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Form Section -->
                    <div class="space-y-6">
                        <!-- Template Selection -->
                        <div class="bg-white rounded-xl shadow-sm border-neutral-200 p-6">
                            <h3 class="text-lg font-semibold text-neutral-900 mb-4">Pilih Template Surat</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-neutral-700 mb-2">Template Surat</label>
                                    <select x-model="suratForm.template" @change="loadTemplate()" 
                                            class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                        <option value="">-- Pilih Template --</option>
                                        <option value="undangan">Undangan Rapat</option>
                                        <option value="pemberitahuan">Pemberitahuan</option>
                                        <option value="edaran">Edaran</option>
                                        <option value="pengantar">Surat Pengantar</option>
                                        <option value="rekomendasi">Surat Rekomendasi</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Nomor Surat -->
                        <div class="bg-white rounded-xl shadow-sm border-neutral-200 p-6">
                            <h3 class="text-lg font-semibold text-neutral-900 mb-4">Nomor Surat</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-neutral-700 mb-2">Kode Arsip</label>
                                    <select x-model="suratForm.kodeArsip" 
                                            class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                        <option value="">-- Pilih Kode Arsip --</option>
                                        <option value="400.1.1">400.1.1 - Surat Masuk Umum</option>
                                        <option value="400.1.2">400.1.2 - Surat Masuk Pribadi</option>
                                        <option value="410.1.1">410.1.1 - Surat Keluar Umum</option>
                                        <option value="410.1.2">410.1.2 - Surat Keluar Pribadi</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-neutral-700 mb-2">Nomor Surat</label>
                                    <div class="flex gap-2">
                                        <input type="text" x-model="suratForm.noSurat" readonly 
                                               class="flex-1 px-4 py-2 border border-neutral-300 rounded-lg bg-neutral-50" 
                                               placeholder="Klik Generate untuk membuat nomor">
                                        <button @click="generateNomorSurat()" 
                                                class="btn-primary">
                                            <i class="fas fa-sync-alt mr-2"></i>
                                            Generate
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-neutral-700 mb-2">Tanggal Surat</label>
                                    <input type="date" x-model="suratForm.tanggal" 
                                           class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                                </div>
                            </div>
                        </div>

                        <!-- Form Fields Dinamis -->
                        <div class="bg-white rounded-xl shadow-sm border-neutral-200 p-6" x-show="suratForm.template">
                            <h3 class="text-lg font-semibold text-neutral-900 mb-4">Isi Surat</h3>
                            <div class="space-y-4">
                                <!-- Perihal -->
                                <div>
                                    <label class="block text-sm font-medium text-neutral-700 mb-2">Perihal</label>
                                    <input type="text" x-model="suratForm.perihal" 
                                           class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                                           placeholder="Masukkan perihal surat">
                                </div>

                                <!-- Tujuan -->
                                <div>
                                    <label class="block text-sm font-medium text-neutral-700 mb-2">Tujuan</label>
                                    <input type="text" x-model="suratForm.tujuan" 
                                           class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                                           placeholder="Masukkan tujuan surat">
                                </div>

                                <!-- Dynamic Fields berdasarkan template -->
                                <div x-show="suratForm.template === 'undangan'">
                                    <label class="block text-sm font-medium text-neutral-700 mb-2">Nama Kegiatan</label>
                                    <input type="text" x-model="suratForm.namaKegiatan" 
                                           class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                                           placeholder="Masukkan nama kegiatan">
                                </div>

                                <div x-show="suratForm.template === 'undangan'">
                                    <label class="block text-sm font-medium text-neutral-700 mb-2">Waktu</label>
                                    <input type="text" x-model="suratForm.waktu" 
                                           class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                                           placeholder="Masukkan waktu kegiatan">
                                </div>

                                <div x-show="suratForm.template === 'undangan'">
                                    <label class="block text-sm font-medium text-neutral-700 mb-2">Tempat</label>
                                    <input type="text" x-model="suratForm.tempat" 
                                           class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                                           placeholder="Masukkan tempat kegiatan">
                                </div>

                                <!-- Isi Surat -->
                                <div>
                                    <label class="block text-sm font-medium text-neutral-700 mb-2">Isi Surat</label>
                                    <textarea x-model="suratForm.isi" rows="6" 
                                              class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                                              placeholder="Masukkan isi surat"></textarea>
                                </div>

                                <!-- Upload File -->
                                <div>
                                    <label class="block text-sm font-medium text-neutral-700 mb-2">Upload File Surat (Opsional)</label>
                                    <input type="file" @change="handleFileUpload($event)" 
                                           class="w-full px-4 py-2 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                                           accept=".pdf,.doc,.docx">
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex gap-4">
                            <button @click="saveSurat()" class="btn-primary">
                                <i class="fas fa-save mr-2"></i>
                                Simpan ke Agenda
                            </button>
                            <button @click="printSurat()" class="btn-secondary" x-show="suratForm.noSurat">
                                <i class="fas fa-print mr-2"></i>
                                Cetak Surat
                            </button>
                        </div>
                    </div>

                    <!-- Preview Section -->
                    <div class="lg:sticky lg:top-24">
                        <div class="bg-white rounded-xl shadow-sm border-neutral-200 p-6">
                            <h3 class="text-lg font-semibold text-neutral-900 mb-4">Preview Surat</h3>
                            <div id="suratPreview" class="border border-neutral-200 rounded-lg p-6 min-h-[600px] bg-white">
                                <div x-show="!suratForm.template" class="text-center text-neutral-500 py-12">
                                    <i class="fas fa-file-alt text-4xl mb-4"></i>
                                    <p>Pilih template untuk melihat preview</p>
                                </div>
                                <div x-show="suratForm.template" class="space-y-4">
                                    <!-- Kop Surat -->
                                    <div class="text-center border-b-2 border-neutral-800 pb-4">
                                        <h4 class="text-lg font-bold">SDN 005 TANJUNG PANDAN</h4>
                                        <p class="text-sm text-neutral-600">Jl. Pendidikan No. 123 Tanjung Pandan</p>
                                        <p class="text-sm text-neutral-600">Telp: (0719) 123456 | Email: sdn005@sch.id</p>
                                    </div>

                                    <!-- Nomor dan Tanggal -->
                                    <div class="flex justify-between text-sm">
                                        <div>Nomor: <span x-text="suratForm.noSurat || '...'"></span></div>
                                        <div>Tanggal: <span x-text="suratForm.tanggal || '...'"></span></div>
                                    </div>

                                    <!-- Perihal -->
                                    <div class="text-center font-bold">
                                        <p x-text="suratForm.perihal || 'Perihal'"></p>
                                    </div>

                                    <!-- Isi Surat -->
                                    <div class="space-y-4">
                                        <div x-show="suratForm.tujuan">
                                            <p>Kepada Yth:</p>
                                            <p x-text="suratForm.tujuan" class="font-semibold"></p>
                                        </div>
                                        <div x-html="suratForm.isi ? suratForm.isi.replace(/\n/g, '<br>') : 'Isi surat akan muncul di sini...'"></div>
                                    </div>

                                    <!-- Penutup -->
                                    <div class="text-right space-y-2">
                                        <p>Demikian surat ini dibuat, atas perhatian kami ucapkan terima kasih.</p>
                                        <div class="mt-8">
                                            <p>Hormat kami,</p>
                                            <br><br><br>
                                            <p>Kepala Sekolah</p>
                                            <div class="border-b-2 border-black w-32"></div>
                                            <p class="font-semibold">Drs. BUDI SANTOSO, M.Pd.</p>
                                            <p class="text-sm">NIP. 19750101 200001 1 001</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Overlay for mobile sidebar -->
    <div x-show="sidebarOpen" @click="sidebarOpen = false" x-cloak
         x-transition:enter="transition-opacity ease-linear duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition-opacity ease-linear duration-300"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-gray-600 bg-opacity-75 z-40 lg:hidden"></div>

    <script>
        function logout() {
            if (confirm('Apakah Anda yakin ingin keluar?')) {
                window.location.href = 'login.html';
            }
        }

        // Alpine.js App
        document.addEventListener('alpine:init', () => {
            Alpine.data('app', () => ({
                sidebarOpen: false,
                currentPage: 'dashboard',
                userRole: 'admin', // Ganti dengan role dari session
                userName: 'Admin User', // Ganti dengan nama dari session
                
                // Surat Form Data
                suratForm: {
                    template: '',
                    kodeArsip: '',
                    noSurat: '',
                    tanggal: new Date().toISOString().split('T')[0],
                    perihal: '',
                    tujuan: '',
                    namaKegiatan: '',
                    waktu: '',
                    tempat: '',
                    isi: '',
                    file: null
                },
                
                // Menu Items
                menuItems: [
                    {
                        id: 'dashboard',
                        name: 'Dashboard',
                        icon: 'fas fa-tachometer-alt',
                        submenu: [
                            { id: 'dashboard-quick', name: 'Quick Akses', icon: 'fas fa-bolt' }
                        ]
                    },
                    {
                        id: 'buat-surat',
                        name: 'Buat Surat',
                        icon: 'fas fa-plus-circle',
                        submenu: [
                            { id: 'buat-surat-keluar', name: 'Buat Surat Keluar', icon: 'fas fa-file-alt', description: 'Menggunakan template surat' }
                        ],
                        roles: ['admin', 'user']
                    },
                    {
                        id: 'agenda-surat',
                        name: 'Agenda Surat',
                        icon: 'fas fa-clipboard-list',
                        submenu: [
                            { id: 'agenda-masuk-upload', name: 'Upload berkas surat masuk', icon: 'fas fa-upload' },
                            { id: 'agenda-masuk-disposisi', name: 'Disposisi surat', icon: 'fas fa-signature', roles: ['admin', 'pimpinan'] },
                            { id: 'agenda-masuk-daftar', name: 'Daftar Surat Masuk', icon: 'fas fa-list' },
                            { id: 'agenda-keluar-upload', name: 'Upload berkas surat keluar', icon: 'fas fa-upload' },
                            { id: 'agenda-keluar-daftar', name: 'Daftar Surat Keluar', icon: 'fas fa-list' }
                        ]
                    },
                    {
                        id: 'arsip',
                        name: 'Arsip',
                        icon: 'fas fa-archive',
                        submenu: [
                            { id: 'arsip-register', name: 'Register Arsip', icon: 'fas fa-plus-square' },
                            { id: 'arsip-daftar', name: 'Daftar Arsip', icon: 'fas fa-folder-open' }
                        ]
                    },
                    {
                        id: 'tentang',
                        name: 'Tentang Aplikasi',
                        icon: 'fas fa-info-circle',
                        submenu: [
                            { id: 'tentang-info', name: 'Info Penggunaan', icon: 'fas fa-question-circle' },
                            { id: 'tentang-feedback', name: 'Feedback / Kontak / Masukan', icon: 'fas fa-comment-dots' },
                            { id: 'logout', name: 'Logout', icon: 'fas fa-sign-out-alt' }
                        ]
                    }
                ],
                
                // Navigation
                navigate(page) {
                    this.currentPage = page;
                    this.sidebarOpen = false;
                },
                
                // Check if user has role
                hasRole(role) {
                    return this.userRole === role;
                },
                
                // Check if user can access menu
                canAccess(menu) {
                    if (!menu.roles) return true;
                    return menu.roles.includes(this.userRole);
                },
                
                // Load Template
                loadTemplate() {
                    // Reset form saat ganti template
                    this.suratForm.perihal = '';
                    this.suratForm.isi = '';
                    
                    // Load template content based on selection
                    const templates = {
                        'undangan': {
                            perihal: 'Undangan',
                            isi: 'Bersama ini kami mengundang Bapak/Ibu untuk menghadiri {{nama_kegiatan}} yang akan diselenggarakan pada:\n\nHari/Tanggal: {{tanggal}}\nPukul: {{waktu}}\nTempat: {{tempat}}\n\nDemikian undangan ini kami sampaikan, atas perhatian dan kehadiran Bapak/Ibu kami ucapkan terima kasih.'
                        },
                        'pemberitahuan': {
                            perihal: 'Pemberitahuan',
                            isi: 'Sehubungan dengan {{perihal}}, bersama ini kami sampaikan bahwa:\n\n{{isi}}\n\nDemikian pemberitahuan ini kami sampaikan untuk menjadi perhatian bersama.'
                        },
                        'edaran': {
                            perihal: 'Edaran',
                            isi: 'Dalam rangka {{perihal}}, dengan ini kami edarkan kepada seluruh warga sekolah untuk:\n\n{{isi}}\n\nEdaran ini berlaku sejak tanggal ditetapkan.'
                        },
                        'pengantar': {
                            perihal: 'Surat Pengantar',
                            isi: 'Bersama ini kami menerangkan bahwa:\n\n{{isi}}\n\nDemikian surat pengantar ini kami buat untuk dapat dipergunakan sebagaimana mestinya.'
                        },
                        'rekomendasi': {
                            perihal: 'Surat Rekomendasi',
                            isi: 'Berdasarkan {{perihal}}, dengan ini kami merekomendasikan:\n\n{{isi}}\n\nSurat rekomendasi ini dibuat berdasarkan pertimbangan dan kebutuhan yang bersangkutan.'
                        }
                    };
                    
                    if (templates[this.suratForm.template]) {
                        this.suratForm.perihal = templates[this.suratForm.template].perihal;
                        this.suratForm.isi = templates[this.suratForm.template].isi;
                    }
                },
                
                // Generate Nomor Surat
                async generateNomorSurat() {
                    if (!this.suratForm.kodeArsip || !this.suratForm.tanggal) {
                        alert('Silakan pilih kode arsip dan tanggal terlebih dahulu');
                        return;
                    }
                    
                    try {
                        // Simulasi generate nomor surat
                        const date = new Date(this.suratForm.tanggal);
                        const year = date.getFullYear();
                        const month = date.getMonth() + 1;
                        const romanMonths = ['I', 'II', 'III', 'IV', 'V', 'VI', 'VII', 'VIII', 'IX', 'X', 'XI', 'XII'];
                        const romanMonth = romanMonths[month - 1];
                        
                        // Generate random 3-digit number (dalam real implementation, ini dari backend)
                        const nomorUrut = String(Math.floor(Math.random() * 999) + 1).padStart(3, '0');
                        
                        this.suratForm.noSurat = `${this.suratForm.kodeArsip}/${nomorUrut}/SDN.005.TPTM/${romanMonth}/${year}`;
                        
                        // Show success notification
                        this.showNotification('Nomor surat berhasil digenerate', 'success');
                        
                    } catch (error) {
                        console.error('Error generating nomor surat:', error);
                        alert('Gagal generate nomor surat. Silakan coba lagi.');
                    }
                },
                
                // Handle File Upload
                handleFileUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        this.suratForm.file = file;
                        this.showNotification('File berhasil diupload', 'success');
                    }
                },
                
                // Save Surat
                async saveSurat() {
                    if (!this.suratForm.template || !this.suratForm.noSurat || !this.suratForm.perihal) {
                        alert('Silakan lengkapi semua field yang required');
                        return;
                    }
                    
                    try {
                        // Simulasi save to backend
                        const suratData = {
                            ...this.suratForm,
                            createdBy: this.userName,
                            createdAt: new Date().toISOString()
                        };
                        
                        // In real implementation, call API here
                        // await this.apiCall('createSuratKeluar', suratData);
                        
                        console.log('Saving surat:', suratData);
                        
                        // Show success notification
                        this.showNotification('Surat berhasil disimpan ke agenda', 'success');
                        
                        // Reset form
                        this.resetForm();
                        
                    } catch (error) {
                        console.error('Error saving surat:', error);
                        alert('Gagal menyimpan surat. Silakan coba lagi.');
                    }
                },
                
                // Print Surat
                printSurat() {
                    if (!this.suratForm.noSurat) {
                        alert('Generate nomor surat terlebih dahulu');
                        return;
                    }
                    
                    // Open print dialog
                    window.print();
                },
                
                // Reset Form
                resetForm() {
                    this.suratForm = {
                        template: '',
                        kodeArsip: '',
                        noSurat: '',
                        tanggal: new Date().toISOString().split('T')[0],
                        perihal: '',
                        tujuan: '',
                        namaKegiatan: '',
                        waktu: '',
                        tempat: '',
                        isi: '',
                        file: null
                    };
                },
                
                // Show Notification
                showNotification(message, type = 'info') {
                    // Create notification element
                    const notification = document.createElement('div');
                    notification.className = `fixed top-20 right-4 z-50 p-4 rounded-lg shadow-lg transform transition-all duration-300 ${
                        type === 'success' ? 'bg-green-500 text-white' : 
                        type === 'error' ? 'bg-red-500 text-white' : 
                        'bg-blue-500 text-white'
                    }`;
                    notification.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas ${
                                type === 'success' ? 'fa-check-circle' : 
                                type === 'error' ? 'fa-exclamation-circle' : 
                                'fa-info-circle'
                            } mr-2"></i>
                            <span>${message}</span>
                        </div>
                    `;
                    
                    document.body.appendChild(notification);
                    
                    // Remove after 3 seconds
                    setTimeout(() => {
                        notification.remove();
                    }, 3000);
                },
                
                // API Call (placeholder for real implementation)
                async apiCall(method, data = null) {
                    // In real implementation, this would call your Google Apps Script backend
                    console.log(`API Call: ${method}`, data);
                    
                    // Simulate API delay
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // Return mock response
                    return { success: true, data: null };
                }
            }));
        });
    </script>
</body>
</html>
