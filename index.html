<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Kearsipan Surat - SDN 005</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        [x-cloak] { display: none !important; }
        .sidebar-transition { transition: transform 0.3s ease-in-out; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Dark Sidebar Styles */
        .sidebar-desktop {
            display: none;
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            border-right: 1px solid rgba(55, 65, 81, 0.5);
            box-shadow: 4px 0 6px -1px rgba(0, 0, 0, 0.3), 2px 4px -2px rgba(0, 0, 0, 0.2);
        }
        
        @media (min-width: 1024px) {
            .sidebar-desktop {
                display: block;
            }
        }
        
        /* Mobile Sidebar - Dark Theme */
        .sidebar-mobile {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            border-right: 1px solid rgba(55, 65, 81, 0.5);
        }
        
        /* Scrollable sidebar */
        .sidebar-scrollable {
            height: calc(100vh - 4rem);
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        /* Custom Dark Scrollbar */
        .sidebar-scrollable::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar-scrollable::-webkit-scrollbar-track {
            background: rgba(17, 24, 39, 0.5);
        }
        
        .sidebar-scrollable::-webkit-scrollbar-thumb {
            background: rgba(75, 85, 99, 0.8);
            border-radius: 3px;
        }
        
        .sidebar-scrollable::-webkit-scrollbar-thumb:hover {
            background: rgba(107, 114, 128, 0.9);
        }
        
        /* Dark sidebar menu styles */
        .sidebar-menu-item {
            color: #d1d5db;
            transition: all 0.2s ease;
        }
        
        .sidebar-menu-item:hover {
            background: rgba(55, 65, 81, 0.5);
            color: #f3f4f6;
        }
        
        .sidebar-menu-item.active {
            background: rgba(20, 184, 166, 0.2);
            color: #14b8a6;
            border-right: 2px solid #14b8a6;
        }
        
        .sidebar-submenu {
            color: #9ca3af;
            transition: all 0.2s ease;
        }
        
        .sidebar-submenu:hover {
            background: rgba(55, 65, 81, 0.3);
            color: #e5e7eb;
        }
        
        .sidebar-submenu.active {
            background: rgba(20, 184, 166, 0.1);
            color: #14b8a6;
        }

        /* Button styles */
        .btn-primary {
            background: #14b8a6;
            color: white;
            border-radius: 0.5rem;
            padding: 0.625rem 1.25rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            border: none;
        }
        
        .btn-primary:hover {
            background: #0d9488;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: white;
            color: #475569;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 0.625rem 1.25rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
        }
        
        .btn-secondary:hover {
            background: #f8fafc;
            border-color: #9ca3af;
            color: #334155;
        }

        /* Card styles */
        .card {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            transition: all 0.2s ease-in-out;
        }

        /* Print styles */
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { font-size: 12pt; }
            .print-header { text-align: center; margin-bottom: 20px; }
            .print-footer { margin-top: 30px; text-align: center; }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans" x-data="sistemKearsipan()">
    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 z-40 bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 border-b border-gray-700 shadow-xl backdrop-blur-sm">
        <div class="px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <button @click="sidebarOpen = !sidebarOpen" class="p-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white transition-all duration-300 lg:hidden">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <div class="flex-shrink-0 flex items-center ml-4 lg:ml-0">
                        <i class="fas fa-school text-teal-600 text-2xl mr-3"></i>
                        <div>
                            <h1 class="text-xl font-bold text-white">Sistem Kearsipan Surat</h1>
                            <p class="text-xs text-gray-300">SDN 005 Tanjung Pandan</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative" x-data="{ notificationOpen: false }">
                        <button @click="notificationOpen = !notificationOpen" class="p-2 rounded-full text-gray-300 hover:text-white hover:bg-gray-700 relative">
                            <i class="fas fa-bell text-lg"></i>
                            <span class="absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-500"></span>
                        </button>
                        <div x-show="notificationOpen" @click.away="notificationOpen = false" x-cloak
                             x-transition:enter="transition ease-out duration-200"
                             x-transition:enter-start="opacity-0 transform scale-95"
                             x-transition:enter-end="opacity-100 transform scale-100"
                             class="absolute right-0 mt-2 w-80 bg-gray-800 rounded-lg shadow-xl border border-gray-700 z-50">
                            <div class="p-4 border-b border-gray-700">
                                <h3 class="text-sm font-medium text-white">Notifikasi</h3>
                            </div>
                            <div class="max-h-64 overflow-y-auto">
                                <div class="p-3 hover:bg-gray-700 cursor-pointer border-b border-gray-600">
                                    <p class="text-sm text-white">Surat masuk baru dari Dinas Pendidikan</p>
                                    <p class="text-xs text-gray-400 mt-1">2 jam yang lalu</p>
                                </div>
                                <div class="p-3 hover:bg-gray-700 cursor-pointer">
                                    <p class="text-sm text-white">Template surat baru ditambahkan</p>
                                    <p class="text-xs text-gray-400 mt-1">1 hari yang lalu</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="relative" x-data="{ profileOpen: false }">
                        <button @click="profileOpen = !profileOpen" class="flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-700">
                            <div class="w-8 h-8 bg-teal-600 rounded-full flex items-center justify-center">
                                <span class="text-white text-sm font-medium" x-text="userRole === 'admin' ? 'A' : userRole === 'pimpinan' ? 'P' : 'U'"></span>
                            </div>
                            <span class="hidden md:block text-sm font-medium text-white" x-text="userRole === 'admin' ? 'Admin' : userRole === 'pimpinan' ? 'Pimpinan' : 'User'"></span>
                            <i class="fas fa-chevron-down text-xs text-gray-400"></i>
                        </button>
                        <div x-show="profileOpen" @click.away="profileOpen = false" x-cloak
                             x-transition:enter="transition ease-out duration-200"
                             x-transition:enter-start="opacity-0 transform scale-95"
                             x-transition:enter-end="opacity-100 transform scale-100"
                             class="absolute right-0 mt-2 w-48 bg-gray-800 rounded-lg shadow-xl border border-gray-700 z-50">
                            <a href="#" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                                <i class="fas fa-user mr-2"></i> Profil
                            </a>
                            <a href="#" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">
                                <i class="fas fa-cog mr-2"></i> Pengaturan
                            </a>
                            <hr class="my-1 border-gray-700">
                            <a href="#" @click="logout()" class="block px-4 py-2 text-sm text-red-400 hover:bg-red-900 hover:text-red-300">
                                <i class="fas fa-sign-out-alt mr-2"></i> Keluar
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Sidebar -->
    <aside x-show="sidebarOpen" 
           x-cloak
           x-transition:enter="transition ease-out duration-200"
           x-transition:enter-start="opacity-0 transform -translate-x-full"
           x-transition:enter-end="opacity-100 transform translate-x-0"
           x-transition:leave="transition ease-in duration-200"
           x-transition:leave-start="opacity-100 transform translate-x-0"
           x-transition:leave-end="opacity-0 transform -translate-x-full"
           class="fixed inset-y-0 left-0 z-50 w-64 sidebar-mobile shadow-xl lg:hidden">
        <div class="flex flex-col h-full pt-16">
            <nav class="flex-1 px-4 py-6 space-y-2 sidebar-scrollable">
                <!-- Dashboard -->
                <div x-data="{ dashboardOpen: false }">
                    <button @click="dashboardOpen = !dashboardOpen; currentPage = 'dashboard'; sidebarOpen = false"
                           :class="currentPage === 'dashboard' ? 'sidebar-menu-item active' : 'sidebar-menu-item'"
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                        <i class="fas fa-tachometer-alt mr-3 w-5"></i>
                        <span class="flex-1 text-left">Dashboard</span>
                        <i :class="dashboardOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="dashboardOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'dashboard-quick'; sidebarOpen = false"
                           :class="currentPage === 'dashboard-quick' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-bolt mr-2 text-xs"></i>Quick Akses
                        </a>
                    </div>
                </div>

                <!-- Buat Surat -->
                <div x-data="{ buatSuratOpen: false }">
                    <button @click="buatSuratOpen = !buatSuratOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item"
                           x-show="['admin', 'user'].includes(userRole)">
                        <i class="fas fa-plus-circle mr-3 w-5"></i>
                        <span class="flex-1 text-left">Buat Surat</span>
                        <i :class="buatSuratOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="buatSuratOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <div x-data="{ buatSuratKeluarOpen: false }">
                            <button @click="buatSuratKeluarOpen = !buatSuratKeluarOpen; currentPage = 'buat-surat-keluar'; sidebarOpen = false"
                                   :class="currentPage === 'buat-surat-keluar' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="w-full flex items-center px-3 py-2 text-sm rounded">
                                <i class="fas fa-file-alt mr-2 text-xs"></i>
                                <span class="flex-1 text-left">Buat Surat Keluar</span>
                                <i :class="buatSuratKeluarOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                            </button>
                            <div x-show="buatSuratKeluarOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                                <div class="px-3 py-2 text-xs text-gray-400">
                                    • Menggunakan template surat
                                </div>
                                <div class="px-3 py-2 text-xs text-gray-400">
                                    • Template dipilih melalui dropdown
                                </div>
                                <div class="px-3 py-2 text-xs text-gray-400" x-show="userRole === 'admin'">
                                    • Template dapat ditambah dan dikelola oleh Admin
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Agenda Surat -->
                <div x-data="{ agendaSuratOpen: false }">
                    <button @click="agendaSuratOpen = !agendaSuratOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-book mr-3 w-5"></i>
                        <span class="flex-1 text-left">Agenda Surat</span>
                        <i :class="agendaSuratOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="agendaSuratOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <div x-data="{ suratMasukOpen: false }">
                            <button @click="suratMasukOpen = !suratMasukOpen; currentPage = 'agenda-masuk'; sidebarOpen = false"
                                   :class="currentPage === 'agenda-masuk' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="w-full flex items-center px-3 py-2 text-sm rounded">
                                <i class="fas fa-inbox mr-2 text-xs"></i>
                                <span class="flex-1 text-left">Masuk</span>
                                <i :class="suratMasukOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                            </button>
                            <div x-show="suratMasukOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                                <a href="#" @click="currentPage = 'agenda-masuk-upload'; sidebarOpen = false" class="block px-3 py-2 text-xs text-gray-400 hover:text-gray-200">
                                    • Upload berkas surat masuk
                                </a>
                                <a href="#" @click="currentPage = 'agenda-masuk-disposisi'; sidebarOpen = false" class="block px-3 py-2 text-xs text-gray-400 hover:text-gray-200" x-show="['admin', 'pimpinan'].includes(userRole)">
                                    • Disposisi surat
                                </a>
                                <a href="#" @click="currentPage = 'agenda-masuk-list'; sidebarOpen = false" class="block px-3 py-2 text-xs text-gray-400 hover:text-gray-200">
                                    • Daftar Surat Masuk
                                </a>
                            </div>
                        </div>
                        <div x-data="{ suratKeluarOpen: false }">
                            <button @click="suratKeluarOpen = !suratKeluarOpen; currentPage = 'agenda-keluar'; sidebarOpen = false"
                                   :class="currentPage === 'agenda-keluar' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="w-full flex items-center px-3 py-2 text-sm rounded">
                                <i class="fas fa-paper-plane mr-2 text-xs"></i>
                                <span class="flex-1 text-left">Keluar</span>
                                <i :class="suratKeluarOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                            </button>
                            <div x-show="suratKeluarOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                                <a href="#" @click="currentPage = 'agenda-keluar-upload'; sidebarOpen = false" class="block px-3 py-2 text-xs text-gray-400 hover:text-gray-200">
                                    • Upload berkas surat keluar
                                </a>
                                <a href="#" @click="currentPage = 'agenda-keluar-list'; sidebarOpen = false" class="block px-3 py-2 text-xs text-gray-400 hover:text-gray-200">
                                    • Daftar Surat Keluar
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Arsip -->
                <div x-data="{ arsipOpen: false }">
                    <button @click="arsipOpen = !arsipOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-archive mr-3 w-5"></i>
                        <span class="flex-1 text-left">Arsip</span>
                        <i :class="arsipOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="arsipOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'arsip-register'; sidebarOpen = false"
                           :class="currentPage === 'arsip-register' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-folder-plus mr-2 text-xs"></i>Register Arsip
                        </a>
                        <a href="#" @click="currentPage = 'arsip-list'; sidebarOpen = false"
                           :class="currentPage === 'arsip-list' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-folder-open mr-2 text-xs"></i>Daftar Arsip
                        </a>
                    </div>
                </div>

                <!-- Template Management (Admin Only) -->
                <div x-data="{ templateOpen: false }" x-show="userRole === 'admin'">
                    <button @click="templateOpen = !templateOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-file-alt mr-3 w-5 text-blue-400"></i>
                        <span class="flex-1 text-left">Template Management</span>
                        <i :class="templateOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="templateOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'template-register'; sidebarOpen = false"
                           :class="currentPage === 'template-register' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-plus-circle mr-2 text-xs text-blue-400"></i>Register Template
                        </a>
                        <a href="#" @click="currentPage = 'template-list'; sidebarOpen = false"
                           :class="currentPage === 'template-list' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-list mr-2 text-xs text-blue-400"></i>Daftar Template
                        </a>
                        <a href="#" @click="currentPage = 'template-edit'; sidebarOpen = false"
                           :class="currentPage === 'template-edit' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-edit mr-2 text-xs text-blue-400"></i>Edit Template
                        </a>
                    </div>
                </div>

                <!-- User Management (Admin Only) -->
                <div x-data="{ userOpen: false }" x-show="userRole === 'admin'">
                    <button @click="userOpen = !userOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-users mr-3 w-5 text-green-400"></i>
                        <span class="flex-1 text-left">Manajemen User</span>
                        <i :class="userOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="userOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'pengguna'; sidebarOpen = false"
                           :class="currentPage === 'pengguna' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-list mr-2 text-xs text-green-400"></i>Daftar User
                        </a>
                        <a href="#" @click="currentPage = 'pengguna-tambah'; sidebarOpen = false"
                           :class="currentPage === 'pengguna-tambah' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-user-plus mr-2 text-xs text-green-400"></i>Tambah User
                        </a>
                        <a href="#" @click="currentPage = 'pengguna-edit'; sidebarOpen = false"
                           :class="currentPage === 'pengguna-edit' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-user-edit mr-2 text-xs text-green-400"></i>Edit User
                        </a>
                        <a href="#" @click="currentPage = 'pengguna-reset'; sidebarOpen = false"
                           :class="currentPage === 'pengguna-reset' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-key mr-2 text-xs text-green-400"></i>Reset Password
                        </a>
                    </div>
                </div>

                <!-- Tentang Aplikasi -->
                <div x-data="{ tentangOpen: false }">
                    <button @click="tentangOpen = !tentangOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-info-circle mr-3 w-5"></i>
                        <span class="flex-1 text-left">Tentang Aplikasi</span>
                        <i :class="tentangOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="tentangOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'tentang-info'; sidebarOpen = false"
                           :class="currentPage === 'tentang-info' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-question-circle mr-2 text-xs"></i>Info Penggunaan
                        </a>
                        <a href="#" @click="currentPage = 'tentang-feedback'; sidebarOpen = false"
                           :class="currentPage === 'tentang-feedback' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-comment mr-2 text-xs"></i>Feedback / Kontak
                        </a>
                        <a href="#" @click="currentPage = 'tentang-masukan'; sidebarOpen = false"
                           :class="currentPage === 'tentang-masukan' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-lightbulb mr-2 text-xs"></i>Masukan
                        </a>
                        <hr class="my-2 border-gray-700">
                        <a href="#" @click="logout(); sidebarOpen = false"
                           class="block px-3 py-2 text-sm rounded text-red-400 hover:text-red-300">
                            <i class="fas fa-sign-out-alt mr-2 text-xs"></i>Logout
                        </a>
                    </div>
                </div>
            </nav>
        </div>
    </aside>

    <!-- Desktop Sidebar -->
    <aside class="sidebar-desktop fixed inset-y-0 left-0 z-30 w-64">
        <div class="flex flex-col h-full pt-16">
            <nav class="flex-1 px-4 py-6 space-y-2 sidebar-scrollable">
                <!-- Dashboard -->
                <div x-data="{ dashboardOpen: false }">
                    <button @click="dashboardOpen = !dashboardOpen; currentPage = 'dashboard'"
                           :class="currentPage === 'dashboard' ? 'sidebar-menu-item active' : 'sidebar-menu-item'"
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg">
                        <i class="fas fa-tachometer-alt mr-3 w-5"></i>
                        <span class="flex-1 text-left">Dashboard</span>
                        <i :class="dashboardOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="dashboardOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'dashboard-quick'"
                           :class="currentPage === 'dashboard-quick' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-bolt mr-2 text-xs"></i>Quick Akses
                        </a>
                    </div>
                </div>

                <!-- Buat Surat -->
                <div x-data="{ buatSuratOpen: false }">
                    <button @click="buatSuratOpen = !buatSuratOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item"
                           x-show="['admin', 'user'].includes(userRole)">
                        <i class="fas fa-plus-circle mr-3 w-5"></i>
                        <span class="flex-1 text-left">Buat Surat</span>
                        <i :class="buatSuratOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="buatSuratOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <div x-data="{ buatSuratKeluarOpen: false }">
                            <button @click="buatSuratKeluarOpen = !buatSuratKeluarOpen; currentPage = 'buat-surat-keluar'"
                                   :class="currentPage === 'buat-surat-keluar' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="w-full flex items-center px-3 py-2 text-sm rounded">
                                <i class="fas fa-file-alt mr-2 text-xs"></i>
                                <span class="flex-1 text-left">Buat Surat Keluar</span>
                                <i :class="buatSuratKeluarOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                            </button>
                            <div x-show="buatSuratKeluarOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                                <div class="px-3 py-2 text-xs text-gray-400">
                                    • Menggunakan template surat
                                </div>
                                <div class="px-3 py-2 text-xs text-gray-400">
                                    • Template dipilih melalui dropdown
                                </div>
                                <div class="px-3 py-2 text-xs text-gray-400" x-show="userRole === 'admin'">
                                    • Template dapat ditambah dan dikelola oleh Admin
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Agenda Surat -->
                <div x-data="{ agendaSuratOpen: false }">
                    <button @click="agendaSuratOpen = !agendaSuratOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-book mr-3 w-5"></i>
                        <span class="flex-1 text-left">Agenda Surat</span>
                        <i :class="agendaSuratOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="agendaSuratOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <div x-data="{ suratMasukOpen: false }">
                            <button @click="suratMasukOpen = !suratMasukOpen; currentPage = 'agenda-masuk'"
                                   :class="currentPage === 'agenda-masuk' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="w-full flex items-center px-3 py-2 text-sm rounded">
                                <i class="fas fa-inbox mr-2 text-xs"></i>
                                <span class="flex-1 text-left">Masuk</span>
                                <i :class="suratMasukOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                            </button>
                            <div x-show="suratMasukOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                                <a href="#" @click="currentPage = 'agenda-masuk-upload'" class="block px-3 py-2 text-xs text-gray-400 hover:text-gray-200">
                                    • Upload berkas surat masuk
                                </a>
                                <a href="#" @click="currentPage = 'agenda-masuk-disposisi'" class="block px-3 py-2 text-xs text-gray-400 hover:text-gray-200" x-show="['admin', 'pimpinan'].includes(userRole)">
                                    • Disposisi surat
                                </a>
                                <a href="#" @click="currentPage = 'agenda-masuk-list'" class="block px-3 py-2 text-xs text-gray-400 hover:text-gray-200">
                                    • Daftar Surat Masuk
                                </a>
                            </div>
                        </div>
                        <div x-data="{ suratKeluarOpen: false }">
                            <button @click="suratKeluarOpen = !suratKeluarOpen; currentPage = 'agenda-keluar'"
                                   :class="currentPage === 'agenda-keluar' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                                   class="w-full flex items-center px-3 py-2 text-sm rounded">
                                <i class="fas fa-paper-plane mr-2 text-xs"></i>
                                <span class="flex-1 text-left">Keluar</span>
                                <i :class="suratKeluarOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                            </button>
                            <div x-show="suratKeluarOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                                <a href="#" @click="currentPage = 'agenda-keluar-upload'" class="block px-3 py-2 text-xs text-gray-400 hover:text-gray-200">
                                    • Upload berkas surat keluar
                                </a>
                                <a href="#" @click="currentPage = 'agenda-keluar-list'" class="block px-3 py-2 text-xs text-gray-400 hover:text-gray-200">
                                    • Daftar Surat Keluar
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Arsip -->
                <div x-data="{ arsipOpen: false }">
                    <button @click="arsipOpen = !arsipOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-archive mr-3 w-5"></i>
                        <span class="flex-1 text-left">Arsip</span>
                        <i :class="arsipOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="arsipOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'arsip-register'"
                           :class="currentPage === 'arsip-register' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-folder-plus mr-2 text-xs"></i>Register Arsip
                        </a>
                        <a href="#" @click="currentPage = 'arsip-list'"
                           :class="currentPage === 'arsip-list' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-folder-open mr-2 text-xs"></i>Daftar Arsip
                        </a>
                    </div>
                </div>

                <!-- Template Management (Admin Only) -->
                <div x-data="{ templateOpen: false }" x-show="userRole === 'admin'">
                    <button @click="templateOpen = !templateOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-file-alt mr-3 w-5 text-blue-400"></i>
                        <span class="flex-1 text-left">Template Management</span>
                        <i :class="templateOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="templateOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'template-register'"
                           :class="currentPage === 'template-register' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-plus-circle mr-2 text-xs text-blue-400"></i>Register Template
                        </a>
                        <a href="#" @click="currentPage = 'template-list'"
                           :class="currentPage === 'template-list' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-list mr-2 text-xs text-blue-400"></i>Daftar Template
                        </a>
                        <a href="#" @click="currentPage = 'template-edit'"
                           :class="currentPage === 'template-edit' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-edit mr-2 text-xs text-blue-400"></i>Edit Template
                        </a>
                    </div>
                </div>

                <!-- User Management (Admin Only) -->
                <div x-data="{ userOpen: false }" x-show="userRole === 'admin'">
                    <button @click="userOpen = !userOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-users mr-3 w-5 text-green-400"></i>
                        <span class="flex-1 text-left">Manajemen User</span>
                        <i :class="userOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="userOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'pengguna'"
                           :class="currentPage === 'pengguna' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-list mr-2 text-xs text-green-400"></i>Daftar User
                        </a>
                        <a href="#" @click="currentPage = 'pengguna-tambah'"
                           :class="currentPage === 'pengguna-tambah' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-user-plus mr-2 text-xs text-green-400"></i>Tambah User
                        </a>
                        <a href="#" @click="currentPage = 'pengguna-edit'"
                           :class="currentPage === 'pengguna-edit' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-user-edit mr-2 text-xs text-green-400"></i>Edit User
                        </a>
                        <a href="#" @click="currentPage = 'pengguna-reset'"
                           :class="currentPage === 'pengguna-reset' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-key mr-2 text-xs text-green-400"></i>Reset Password
                        </a>
                    </div>
                </div>

                <!-- Tentang Aplikasi -->
                <div x-data="{ tentangOpen: false }">
                    <button @click="tentangOpen = !tentangOpen" 
                           class="w-full flex items-center px-3 py-2 text-sm font-medium rounded-lg sidebar-menu-item">
                        <i class="fas fa-info-circle mr-3 w-5"></i>
                        <span class="flex-1 text-left">Tentang Aplikasi</span>
                        <i :class="tentangOpen ? 'fas fa-chevron-down' : 'fas fa-chevron-right'" class="text-xs"></i>
                    </button>
                    <div x-show="tentangOpen" x-cloak x-transition class="ml-8 mt-1 space-y-1">
                        <a href="#" @click="currentPage = 'tentang-info'"
                           :class="currentPage === 'tentang-info' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-question-circle mr-2 text-xs"></i>Info Penggunaan
                        </a>
                        <a href="#" @click="currentPage = 'tentang-feedback'"
                           :class="currentPage === 'tentang-feedback' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-comment mr-2 text-xs"></i>Feedback / Kontak
                        </a>
                        <a href="#" @click="currentPage = 'tentang-masukan'"
                           :class="currentPage === 'tentang-masukan' ? 'sidebar-submenu active' : 'sidebar-submenu'"
                           class="block px-3 py-2 text-sm rounded">
                            <i class="fas fa-lightbulb mr-2 text-xs"></i>Masukan
                        </a>
                        <hr class="my-2 border-gray-700">
                        <a href="#" @click="logout()"
                           class="block px-3 py-2 text-sm rounded text-red-400 hover:text-red-300">
                            <i class="fas fa-sign-out-alt mr-2 text-xs"></i>Logout
                        </a>
                    </div>
                </div>
            </nav>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="lg:ml-64 pt-16">
        <div class="px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard Page -->
            <div x-show="currentPage === 'dashboard'" x-cloak class="fade-in">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900">Dashboard</h2>
                    <p class="text-gray-600">Selamat datang di Sistem Kearsipan Surat SDN 005</p>
                </div>

                <!-- Welcome Section -->
                <div class="bg-white rounded-xl shadow-sm border-gray-200 p-8 mb-8">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">Selamat Datang!</h3>
                            <p class="text-gray-600">Sistem kearsipan surat digital siap membantu pekerjaan administrasi sekolah Anda.</p>
                        </div>
                        <div class="text-right">
                            <span class="inline-flex items-center px-3 py-1 rounded-full bg-green-500 text-white text-sm font-medium">
                                <i class="fas fa-check-circle mr-2"></i>
                                <span x-text="userRole === 'admin' ? 'Administrator' : userRole === 'pimpinan' ? 'Pimpinan' : 'User'"></span>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <div class="card p-6 hover:shadow-lg cursor-pointer" @click="currentPage = 'buat-surat-keluar'" x-show="['admin', 'user'].includes(userRole)">
                        <div class="flex items-center">
                            <div class="p-3 bg-teal-600 rounded-xl mr-4">
                                <i class="fas fa-plus-circle text-white text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">Buat Surat</h4>
                                <p class="text-sm text-gray-600">Buat surat keluar dengan template</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card p-6 hover:shadow-lg cursor-pointer" @click="currentPage = 'agenda-masuk-upload'">
                        <div class="flex items-center">
                            <div class="p-3 bg-blue-600 rounded-xl mr-4">
                                <i class="fas fa-upload text-white text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">Upload Surat Masuk</h4>
                                <p class="text-sm text-gray-600">Upload surat masuk baru</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card p-6 hover:shadow-lg cursor-pointer" @click="currentPage = 'arsip-register'">
                        <div class="flex items-center">
                            <div class="p-3 bg-purple-600 rounded-xl mr-4">
                                <i class="fas fa-archive text-white text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">Register Arsip</h4>
                                <p class="text-sm text-gray-600">Daftarkan dokumen</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-xl shadow-sm border-gray-200 p-8">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-semibold text-gray-900">Aktivitas Terkini</h3>
                        <button class="btn-secondary text-sm">
                            <i class="fas fa-sync-alt mr-2"></i>
                            Refresh
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="flex items-start p-4 bg-gray-50 rounded-lg">
                            <div class="flex-shrink-0">
                                <div class="p-2 bg-green-500 rounded-full">
                                    <i class="fas fa-check text-white text-sm"></i>
                                </div>
                            </div>
                            <div class="ml-4 flex-1">
                                <p class="text-sm font-medium text-gray-900">Surat masuk baru telah diupload</p>
                                <p class="text-xs text-gray-500">Dari Dinas Pendidikan</p>
                                <p class="text-xs text-gray-400">2 jam yang lalu</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start p-4 bg-gray-50 rounded-lg">
                            <div class="flex-shrink-0">
                                <div class="p-2 bg-yellow-500 rounded-full">
                                    <i class="fas fa-clock text-white text-sm"></i>
                                </div>
                            </div>
                            <div class="ml-4 flex-1">
                                <p class="text-sm font-medium text-gray-900">Menunggu disposisi</p>
                                <p class="text-xs text-gray-500">5 surat menunggu disposisi</p>
                                <p class="text-xs text-gray-400">Perlu ditindaklan</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start p-4 bg-gray-50 rounded-lg">
                            <div class="flex-shrink-0">
                                <div class="p-2 bg-red-500 rounded-full">
                                    <i class="fas fa-exclamation-triangle text-white text-sm"></i>
                                </div>
                            </div>
                            <div class="ml-4 flex-1">
                                <p class="text-sm font-medium text-gray-900">Template perlu diperbarui</p>
                                <p class="text-xs text-gray-500">3 template perlu update</p>
                                <p class="text-xs text-gray-400">Hubungi admin</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Buat Surat Keluar Page -->
            <div x-show="currentPage === 'buat-surat-keluar'" x-cloak class="fade-in">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900">Buat Surat Keluar</h2>
                    <p class="text-gray-600">Buat surat keluar dengan template yang tersedia</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Form Section -->
                    <div class="space-y-6">
                        <!-- Template Selection -->
                        <div class="bg-white rounded-xl shadow-sm border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Template Surat</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Template Surat</label>
                                    <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="suratForm.template" @change="loadTemplate()">
                                        <option value="">-- Pilih Template --</option>
                                        <template x-for="template in suratTemplates" :key="template.id">
                                            <option :value="template.id" x-text="template.nama"></option>
                                        </template>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Nomor Surat -->
                        <div class="bg-white rounded-xl shadow-sm border-gray-200 p-6" x-show="suratForm.template">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Nomor Surat</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Kode Arsip</label>
                                    <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="suratForm.kodeArsip">
                                        <option value="">-- Pilih Kode Arsip --</option>
                                        <template x-for="kode in kodeArsipOptions" :key="kode.kode">
                                            <option :value="kode.kode" x-text="`${kode.kode} - ${kode.nama}`"></option>
                                        </template>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal Surat</label>
                                    <input type="date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="suratForm.tanggal">
                                </div>
                                <div class="flex items-center space-x-4">
                                    <input type="text" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" x-model="suratForm.noSurat" readonly placeholder="Klik Generate untuk membuat nomor">
                                    <button class="btn-primary" @click="generateNomorSurat()" :disabled="loading">
                                        <i class="fas fa-cog mr-2" x-show="!loading"></i>
                                        <i class="fas fa-spinner fa-spin mr-2" x-show="loading"></i>
                                        <span x-text="loading ? 'Generating...' : 'Generate'"></span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Form Fields -->
                        <div class="bg-white rounded-xl shadow-sm border-gray-200 p-6" x-show="suratForm.template">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Detail Surat</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Perihal</label>
                                    <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="suratForm.perihal" placeholder="Masukkan perihal surat">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tujuan</label>
                                    <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="suratForm.tujuan" placeholder="Masukkan tujuan surat">
                                </div>
                                
                                <!-- Dynamic fields for undangan -->
                                <div x-show="suratForm.template === 'undangan'">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Nama Kegiatan</label>
                                            <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="suratForm.namaKegiatan" placeholder="Masukkan nama kegiatan">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Waktu</label>
                                            <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="suratForm.waktu" placeholder="Masukkan waktu kegiatan">
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Tempat</label>
                                        <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="suratForm.tempat" placeholder="Masukkan tempat kegiatan">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Isi Surat</label>
                                    <textarea class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="suratForm.isi" rows="6" placeholder="Masukkan isi surat"></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Upload File (Opsional)</label>
                                    <input type="file" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" @change="handleFileUpload($event)" accept=".pdf,.doc,.docx">
                                </div>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="bg-white rounded-xl shadow-sm border-gray-200 p-6" x-show="suratForm.template">
                            <div class="flex space-x-4">
                                <button class="btn-primary" @click="saveSurat()" :disabled="loading">
                                    <i class="fas fa-save mr-2" x-show="!loading"></i>
                                    <i class="fas fa-spinner fa-spin mr-2" x-show="loading"></i>
                                    <span x-text="loading ? 'Menyimpan...' : 'Simpan ke Agenda'"></span>
                                </button>
                                <button class="btn-secondary" @click="printSurat()" x-show="suratForm.noSurat">
                                    <i class="fas fa-print mr-2"></i>
                                    Cetak Surat
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Preview Section -->
                    <div class="lg:sticky lg:top-24">
                        <div class="bg-white rounded-xl shadow-sm border-gray-200 p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Preview Surat</h3>
                            
                            <div class="text-center text-gray-500 py-12" x-show="!suratForm.template">
                                <i class="fas fa-file-alt text-6xl mb-4"></i>
                                <p>Pilih template untuk melihat preview</p>
                            </div>
                            
                            <div class="space-y-4" x-show="suratForm.template">
                                <!-- Header -->
                                <div class="text-center border-b pb-4">
                                    <h4 class="text-lg font-bold">SDN 005 TANJUNGPANDAN</h4>
                                    <p class="text-sm text-gray-600">Jl. Pendidikan No. 123, Tanjungpandan</p>
                                </div>
                                
                                <!-- Nomor dan Tanggal -->
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="text-sm font-semibold">Nomor: <span x-text="suratForm.noSurat || '...'"></span></p>
                                    </div>
                                    <div>
                                        <p class="text-sm">Tanjungpandan, <span x-text="suratForm.tanggal || '...'"></span></p>
                                    </div>
                                </div>
                                
                                <!-- Content -->
                                <div class="space-y-4">
                                    <div>
                                        <p class="font-semibold">Perihal: <span x-text="suratForm.perihal || 'Perihal'"></span></p>
                                    </div>
                                    
                                    <div x-show="suratForm.tujuan">
                                        <p>Kepada Yth:</p>
                                        <p class="font-semibold" x-text="suratForm.tujuan"></p>
                                    </div>
                                    
                                    <div class="whitespace-pre-wrap" x-html="suratForm.isi ? suratForm.isi.replace(/\n/g, '<br>') : 'Isi surat akan muncul di sini...'"></div>
                                </div>
                                
                                <!-- Footer -->
                                <div class="border-t pt-4">
                                    <div class="flex justify-between">
                                        <div>
                                            <p class="text-sm font-semibold">Mengetahui,</p>
                                            <p class="text-sm">Kepala Sekolah</p>
                                            <br><br>
                                            <p class="text-sm font-semibold underline">(Nama Kepala Sekolah)</p>
                                            <p class="text-sm">NIP. 1234567890123456</p>
                                        </div>
                                        <div>
                                            <p class="text-sm font-semibold">Menyetujui,</p>
                                            <p class="text-sm">Admin</p>
                                            <br><br>
                                            <p class="text-sm font-semibold underline">(Nama Admin)</p>
                                            <p class="text-sm">NIP. 1234567890123456</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Template Register Page -->
            <div x-show="currentPage === 'template-register'" x-cloak class="fade-in">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900">Register Template</h2>
                    <p class="text-gray-600">Buat template surat baru untuk digunakan di sistem</p>
                </div>

                <div class="max-w-4xl mx-auto">
                    <div class="bg-white rounded-xl shadow-sm border-gray-200 p-8">
                        <form @submit.prevent="registerTemplate()">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Left Column -->
                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Template *</label>
                                        <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="templateForm.nama" placeholder="Masukkan nama template" required>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Kategori *</label>
                                        <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="templateForm.kategori" required>
                                            <option value="">-- Pilih Kategori --</option>
                                            <option value="Undangan">Undangan</option>
                                            <option value="Pemberitahuan">Pemberitahuan</option>
                                            <option value="Edaran">Edaran</option>
                                            <option value="Pengantar">Pengantar</option>
                                            <option value="Keterangan">Keterangan</option>
                                            <option value="Lainnya">Lainnya</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Variabel Template</label>
                                        <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="templateForm.variables" placeholder="Contoh: {{nomorSurat}}, {{tanggal}}, {{perihal}}">
                                        <p class="text-xs text-gray-500 mt-1">Gunakan format {{variable}} untuk variabel yang akan diganti otomatis</p>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                        <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="templateForm.status">
                                            <option value="Aktif">Aktif</option>
                                            <option value="Draft">Draft</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Right Column -->
                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Konten Template</label>
                                        <textarea class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="templateForm.content" rows="12" placeholder="Masukkan konten template dengan variabel"></textarea>
                                        <p class="text-xs text-gray-500 mt-1">Gunakan variabel seperti {{nomorSurat}}, {{tanggal}}, {{perihal}} yang akan diganti otomatis</p>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Upload File Template (Opsional)</label>
                                        <input type="file" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" @change="handleTemplateFileUpload($event)" accept=".doc,.docx,.pdf">
                                        <p class="text-xs text-gray-500 mt-1">Upload file template yang sudah ada (doc, docx, pdf)</p>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi</label>
                                        <textarea class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="templateForm.deskripsi" rows="3" placeholder="Deskripsi template"></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Actions -->
                            <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
                                <button type="button" @click="resetTemplateForm()" class="btn-secondary">
                                    <i class="fas fa-times mr-2"></i>
                                    Reset
                                </button>
                                <button type="submit" class="btn-primary" :disabled="loading">
                                    <i class="fas fa-save mr-2" x-show="!loading"></i>
                                    <i class="fas fa-spinner fa-spin mr-2" x-show="loading"></i>
                                    <span x-text="loading ? 'Menyimpan...' : 'Register Template'"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Template List Page -->
            <div x-show="currentPage === 'template-list'" x-cloak class="fade-in">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900">Daftar Template</h2>
                    <p class="text-gray-600">Kelola semua template surat yang tersedia</p>
                </div>

                <!-- Search and Filter -->
                <div class="bg-white rounded-xl shadow-sm border-gray-200 p-6 mb-8">
                    <div class="flex flex-col md:flex-row gap-4">
                        <div class="flex-1">
                            <div class="relative">
                                <input type="text" class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="searchQuery" placeholder="Cari template...">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-search text-gray-400"></i>
                                </div>
                            </div>
                        </div>
                        <div>
                            <select class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="filterKategori">
                                <option value="">Semua Kategori</option>
                                <option value="Undangan">Undangan</option>
                                <option value="Pemberitahuan">Pemberitahuan</option>
                                <option value="Edaran">Edaran</option>
                                <option value="Pengantar">Pengantar</option>
                                <option value="Keterangan">Keterangan</option>
                                <option value="Lainnya">Lainnya</option>
                            </select>
                        </div>
                        <div>
                            <button @click="refreshTemplates()" class="btn-secondary">
                                <i class="fas fa-sync-alt mr-2"></i>
                                Refresh
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-sm border-gray-200 p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-blue-100 rounded-lg mr-4">
                                <i class="fas fa-file-alt text-blue-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-gray-900" x-text="templateStats.total || 0"></p>
                                <p class="text-sm text-gray-600">Total Template</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm border-gray-200 p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-green-100 rounded-lg mr-4">
                                <i class="fas fa-check-circle text-green-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-gray-900" x-text="templateStats.aktif || 0"></p>
                                <p class="text-sm text-gray-600">Template Aktif</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm border-gray-200 p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-yellow-100 rounded-lg mr-4">
                                <i class="fas fa-edit text-yellow-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-gray-900" x-text="templateStats.draft || 0"></p>
                                <p class="text-sm text-gray-600">Template Draft</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm border-gray-200 p-6">
                        <div class="flex items-center">
                            <div class="p-3 bg-purple-100 rounded-lg mr-4">
                                <i class="fas fa-clock text-purple-600 text-xl"></i>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-gray-900" x-text="templateStats.recent || 0"></p>
                                <p class="text-sm text-gray-600">Dibuat 7 Hari Terakhir</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Templates Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <template x-for="template in filteredTemplates" :key="template.id">
                        <div class="bg-white rounded-xl shadow-sm border-gray-200 p-6 hover:shadow-lg transition-shadow">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900" x-text="template.nama"></h3>
                                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium" :class="template.status === 'Aktif' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'" x-text="template.status"></span>
                                </div>
                                <div class="flex space-x-2">
                                    <button @click="editTemplate(template)" class="text-blue-600 hover:text-blue-800">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button @click="deleteTemplate(template)" class="text-red-600 hover:text-red-800">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="space-y-2">
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-folder mr-2"></i>
                                    <span x-text="template.kategori"></span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-calendar mr-2"></i>
                                    <span x-text="template.createdAt"></span>
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i class="fas fa-clock mr-2"></i>
                                    <span x-text="template.updatedAt"></span>
                                </div>
                            </div>
                            
                            <div class="pt-4 border-t border-gray-200">
                                <p class="text-sm text-gray-600 line-clamp" x-text="template.deskripsi || 'Tidak ada deskripsi'"></p>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Empty State -->
                <div x-show="filteredTemplates.length === 0" class="text-center py-12">
                    <i class="fas fa-file-alt text-6xl text-gray-400 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2">Tidak Ada Template</h3>
                    <p class="text-gray-600">Belum ada template yang terdaftar</p>
                    <button @click="currentPage = 'template-register'" class="btn-primary mt-4">
                        <i class="fas fa-plus mr-2"></i>
                        Buat Template Pertama
                    </button>
                </div>
            </div>

            <!-- Template Edit Page -->
            <div x-show="currentPage === 'template-edit'" x-cloak class="fade-in">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-gray-900">Edit Template</h2>
                    <p class="text-gray-600">Edit template yang sudah ada</p>
                </div>

                <div class="max-w-4xl mx-auto">
                    <div class="bg-white rounded-xl shadow-sm border-gray-200 p-8">
                        <form @submit.prevent="updateTemplate()">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Left Column -->
                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Template *</label>
                                        <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="editTemplateForm.nama" placeholder="Masukkan nama template" required>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Kategori *</label>
                                        <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="editTemplateForm.kategori" required>
                                            <option value="">-- Pilih Kategori --</option>
                                            <option value="Undangan">Undangan</option>
                                            <option value="Pemberitahuan">Pemberitahuan</option>
                                            <option value="Edaran">Edaran</option>
                                            <option value="Pengantar">Pengantar</option>
                                            <option value="Keterangan">Keterangan</option>
                                            <option value="Lainnya">Lainnya</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Variabel Template</label>
                                        <input type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="editTemplateForm.variables" placeholder="Contoh: {{nomorSurat}}, {{tanggal}}, {{perihal}}">
                                        <p class="text-xs text-gray-500 mt-1">Gunakan format {{variable}} untuk variabel yang akan diganti otomatis</p>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                        <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="editTemplateForm.status">
                                            <option value="Aktif">Aktif</option>
                                            <option value="Draft">Draft</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Right Column -->
                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Konten Template</label>
                                        <textarea class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="editTemplateForm.content" rows="12" placeholder="Masukkan konten template dengan variabel"></textarea>
                                        <p class="text-xs text-gray-500 mt-1">Gunakan variabel seperti {{nomorSurat}}, {{tanggal}}, {{perihal}} yang akan diganti otomatis</p>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Upload File Template (Opsional)</label>
                                        <input type="file" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" @change="handleEditTemplateFileUpload($event)" accept=".doc,.docx,.pdf">
                                        <p class="text-xs text-gray-500 mt-1">Upload file template yang sudah ada (doc, docx, pdf)</p>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi</label>
                                        <textarea class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" x-model="editTemplateForm.deskripsi" rows="3" placeholder="Deskripsi template"></textarea>
                                    </div>
                                    
                                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                        <p class="text-sm text-blue-800">
                                            <i class="fas fa-info-circle mr-2"></i>
                                            <strong>Info:</strong> Template akan otomatis dibuatkan di Google Docs untuk digunakan dalam sistem.
                                        </p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Actions -->
                            <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
                                <button type="button" @click="cancelEditTemplate()" class="btn-secondary">
                                    <i class="fas fa-times mr-2"></i>
                                    Batal
                                </button>
                                <button type="submit" class="btn-primary" :disabled="loading">
                                    <i class="fas fa-save mr-2" x-show="!loading"></i>
                                    <i class="fas fa-spinner fa-spin mr-2" x-show="loading"></i>
                                    <span x-text="loading ? 'Menyimpan...' : 'Update Template'"></span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Placeholder untuk halaman lain -->
            <div x-show="currentPage !== 'dashboard' && currentPage !== 'buat-surat-keluar' && currentPage !== 'template-register' && currentPage !== 'template-list' && currentPage !== 'template-edit'" x-cloak class="fade-in">
                <div class="bg-white rounded-xl shadow-sm border-gray-200 p-8 text-center">
                    <i class="fas fa-tools text-6xl text-gray-400 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-900 mb-4">Halaman Sedang Dikembangkan</h3>
                    <p class="text-gray-600 mb-4">Halaman <span x-text="currentPage" class="font-mono bg-gray-100 px-2 py-1 rounded"></span> sedang dalam pengembangan</p>
                    <button @click="currentPage = 'dashboard'" class="btn-primary">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Kembali ke Dashboard
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Notification -->
    <div x-show="notification.show" 
         x-cloak
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform translate-y-full"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 transform translate-y-0"
         x-transition:leave-end="opacity-0 transform translate-y-full"
         class="fixed bottom-4 right-4 z-50 max-w-sm">
        <div class="rounded-lg shadow-lg p-4" 
             :class="notification.type === 'success' ? 'bg-green-500 text-white' : 
                     notification.type === 'error' ? 'bg-red-500 text-white' : 
                     notification.type === 'warning' ? 'bg-yellow-500 text-white' : 
                     'bg-blue-500 text-white'">
            <div class="flex items-center">
                <i class="fas mr-2" 
                   :class="notification.type === 'success' ? 'fa-check-circle' : 
                           notification.type === 'error' ? 'fa-exclamation-circle' : 
                           notification.type === 'warning' ? 'fa-exclamation-triangle' : 
                           'fa-info-circle'"></i>
                <span x-text="notification.message"></span>
            </div>
        </div>
    </div>

    <script>
        function sistemKearsipan() {
            return {
                sidebarOpen: false,
                currentPage: 'dashboard',
                userRole: 'admin',
                loading: false,
                
                // Form data
                suratForm: {
                    template: '',
                    kodeArsip: '',
                    noSurat: '',
                    tanggal: '',
                    perihal: '',
                    tujuan: '',
                    namaKegiatan: '',
                    waktu: '',
                    tempat: '',
                    isi: '',
                    file: null
                },
                
                // Template forms
                templateForm: {
                    nama: '',
                    kategori: '',
                    variables: '',
                    content: '',
                    deskripsi: '',
                    status: 'Aktif',
                    file: null
                },
                
                editTemplateForm: {
                    id: '',
                    nama: '',
                    kategori: '',
                    variables: '',
                    content: '',
                    deskripsi: '',
                    status: 'Aktif',
                    file: null
                },
                
                // Data dari database
                suratTemplates: [],
                
                kodeArsipOptions: [],
                
                // Search and filter
                searchQuery: '',
                filterKategori: '',
                
                // Statistics
                templateStats: {
                    total: 0,
                    aktif: 0,
                    draft: 0,
                    recent: 0
                },
                
                notification: {
                    show: false,
                    message: '',
                    type: 'info'
                },
                
                // API Configuration
                apiBase: 'https://script.google.com/macros/s/AKfycbxtLfyDfzhDiQvU2saKpU0zIRPQKCQyj46Fs4tLK7r8nt3LoHNSbMFd0vRkYXavSJfc/exec',
                
                // Current editing template
                currentEditingTemplate: null,
                
                // Init
                init() {
                    this.loadInitialData();
                },
                
                // Load data dari database
                async loadInitialData() {
                    try {
                        await Promise.all([
                            this.loadTemplates(),
                            this.loadKodeArsip()
                        ]);
                    } catch (error) {
                        console.error('Failed to load initial data:', error);
                    }
                },
                
                async loadTemplates() {
                    try {
                        const response = await this.apiCall('getTemplates');
                        if (response.status === 'success' && response.data) {
                            this.suratTemplates = response.data;
                            console.log('Templates loaded successfully:', this.suratTemplates.length);
                            this.updateTemplateStats();
                        }
                    } catch (error) {
                        console.log('API failed, using fallback templates');
                        // Fallback templates jika error
                        this.suratTemplates = [
                            {
                                id: 'undangan',
                                nama: 'Undangan Rapat',
                                kategori: 'Undangan',
                                variables: ['{{nomorSurat}}', '{{tanggal}}', '{{perihal}}', '{{tujuan}}', '{{namaKegiatan}}', '{{waktu}}', '{{tempat}}'],
                                content: 'Berdasarkan hasil rapat kami akan mengadakan kegiatan {{namaKegiatan}} pada:\n\nWaktu: {{waktu}}\nTempat: {{tempat}}\n\nDemikian undangan ini kami sampaikan, atas perhatian dan kehadirannya kami ucapkan terima kasih.',
                                status: 'Aktif',
                                createdAt: '2024-01-01',
                                updatedAt: '2024-01-01',
                                deskripsi: 'Template undangan rapat untuk kegiatan sekolah'
                            },
                            {
                                id: 'pemberitahuan',
                                nama: 'Pemberitahuan',
                                kategori: 'Pemberitahuan',
                                variables: ['{{nomorSurat}}', '{{tanggal}}', '{{perihal}}', '{{tujuan}}'],
                                content: 'Dengan hormat,\n\nBersama ini kami sampaikan pemberitahuan {{perihal}} kepada {{tujuan}}.\n\nPemberitahuan ini berlaku efektif sejak tanggal ditetapkan.\n\nDemikian pemberitahuan ini kami sampaikan, atas perhatian dan kerjasamanya kami ucapkan terima kasih.',
                                status: 'Aktif',
                                createdAt: '2024-01-01',
                                updatedAt: '2024-01-01',
                                deskripsi: 'Template pemberitahuan umum untuk berbagai keperluan'
                            },
                            {
                                id: 'edaran',
                                nama: 'Edaran',
                                kategori: 'Edaran',
                                variables: ['{{nomorSurat}}', '{{tanggal}}', '{{perihal}}', '{{tujuan}}'],
                                content: 'Assalamualaikum Wr. Wb.\n\nBismillahirrahmanirrahim\n\nSehubungan dengan {{perihal}}, kami edarkan kepada {{tujuan}} untuk memperhatikan hal-hal sebagai berikut:\n\n1. [Isi edaran]\n2. [Isi edaran]\n3. [Isi edaran]\n\nDemikian edaran ini kami sampaikan untuk diindahkan dan dilaksanakan sebagaimana mestinya.\n\nWassalamualaikum Wr. Wb.',
                                status: 'Aktif',
                                createdAt: '2024-01-01',
                                updatedAt: '2024-01-01',
                                deskripsi: 'Template edaran untuk informasi resmi sekolah'
                            },
                            {
                                id: 'pengantar',
                                nama: 'Surat Pengantar',
                                kategori: 'Pengantar',
                                variables: ['{{nomorSurat}}', '{{tanggal}}', '{{perihal}}', '{{tujuan}}'],
                                content: 'Yang terhormat,\n\nDengan hormat kami sampaikan bahwa kami akan mengantar {{perihal}} kepada {{tujuan}}.\n\nBersama ini kami lampirkan dokumen-dokumen yang diperlukan:\n\n1. [Dokumen 1]\n2. [Dokumen 2]\n3. [Dokumen 3]\n\nDemikian surat pengantar ini kami buat, atas perhatian dan kerjasamanya kami ucapkan terima kasih.',
                                status: 'Aktif',
                                createdAt: '2024-01-01',
                                updatedAt: '2024-01-01',
                                deskripsi: 'Template surat pengantar untuk berbagai keperluan'
                            },
                            {
                                id: 'rekomendasi',
                                nama: 'Surat Rekomendasi',
                                kategori: 'Keterangan',
                                variables: ['{{nomorSurat}}', '{{tanggal}}', '{{perihal}}', '{{tujuan}}'],
                                content: 'Yang terhormat,\n\nBerdasarkan pengalaman dan penilaian kami, kami dengan ini merekomendasikan {{perihal}} kepada {{tujuan}}.\n\nPertimbangan kami merekomendasikan adalah:\n\n1. [Alasan 1]\n2. [Alasan 2]\n3. [Alasan 3]\n\nDemikian surat rekomendasi ini kami buat dengan sebenar-benarnya untuk dapat dipergunakan sebagaimana mestinya.',
                                status: 'Aktif',
                                createdAt: '2024-01-01',
                                updatedAt: '2024-01-01',
                                deskripsi: 'Template surat rekomendasi untuk berbagai keperluan'
                            }
                        ];
                        console.log('Fallback templates loaded:', this.suratTemplates.length);
                        this.updateTemplateStats();
                    }
                },
                
                async loadKodeArsip() {
                    try {
                        const response = await this.apiCall('getKodeArsip');
                        if (response.status === 'success' && response.data) {
                            this.kodeArsipOptions = response.data;
                            console.log('Kode arsip loaded successfully:', this.kodeArsipOptions.length);
                        }
                    } catch (error) {
                        console.log('API failed, using fallback kode arsip');
                        // Fallback kode arsip jika error
                        this.kodeArsipOptions = [
                            { kode: '400.1.1', nama: 'Kearsipan Umum' },
                            { kode: '400.2.1', nama: 'Kearsipan Kepegawaian' },
                            { kode: '400.3.1', nama: 'Kearsipan Keuangan' },
                            { kode: '400.4.1', nama: 'Kearsipan Sarana Prasarana' }
                        ];
                        console.log('Fallback kode arsip loaded:', this.kodeArsipOptions.length);
                    }
                },
                
                // Get filtered templates
                get filteredTemplates() {
                    let filtered = this.suratTemplates;
                    
                    // Apply search filter
                    if (this.searchQuery) {
                        const query = this.searchQuery.toLowerCase();
                        filtered = filtered.filter(template => 
                            template.nama.toLowerCase().includes(query) ||
                            template.deskripsi.toLowerCase().includes(query)
                        );
                    }
                    
                    // Apply category filter
                    if (this.filterKategori) {
                        filtered = filtered.filter(template => template.kategori === this.filterKategori);
                    }
                    
                    return filtered;
                },
                
                // Update template statistics
                updateTemplateStats() {
                    this.templateStats = {
                        total: this.suratTemplates.length,
                        aktif: this.suratTemplates.filter(t => t.status === 'Aktif').length,
                        draft: this.suratTemplates.filter(t => t.status === 'Draft').length,
                        recent: this.suratTemplates.filter(t => {
                            const createdDate = new Date(t.createdAt);
                            const sevenDaysAgo = new Date();
                            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
                            return createdDate >= sevenDaysAgo;
                        }).length
                    };
                },
                
                // Refresh templates
                async refreshTemplates() {
                    this.loading = true;
                    try {
                        await this.loadTemplates();
                        this.showNotification('Template berhasil di-refresh', 'success');
                    } catch (error) {
                        this.showNotification('Gagal refresh template', 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // Register template
                async registerTemplate() {
                    this.loading = true;
                    try {
                        const response = await this.apiCall('createTemplate', this.templateForm);
                        
                        if (response.status === 'success') {
                            this.showNotification('Template berhasil dibuat', 'success');
                            this.resetTemplateForm();
                            this.currentPage = 'template-list';
                            await this.loadTemplates();
                        } else {
                            throw new Error(response.message || 'Failed to create template');
                        }
                    } catch (error) {
                        console.error('Error creating template:', error);
                        this.showNotification('Gagal membuat template', 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // Edit template
                editTemplate(template) {
                    this.currentEditingTemplate = template;
                    this.editTemplateForm = {
                        id: template.id,
                        nama: template.nama,
                        kategori: template.kategori,
                        variables: template.variables,
                        content: template.content,
                        deskripsi: template.deskripsi,
                        status: template.status,
                        file: null
                    };
                    this.currentPage = 'template-edit';
                },
                
                // Update template
                async updateTemplate() {
                    this.loading = true;
                    try {
                        const response = await this.apiCall('updateTemplate', this.editTemplateForm);
                        
                        if (response.status === 'success') {
                            this.showNotification('Template berhasil diupdate', 'success');
                            this.currentEditingTemplate = null;
                            this.currentPage = 'template-list';
                            await this.loadTemplates();
                        } else {
                            throw new Error(response.message || 'Failed to update template');
                        }
                    } catch (error) {
                        console.error('Error updating template:', error);
                        this.showNotification('Gagal update template', 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // Delete template
                async deleteTemplate(template) {
                    if (!confirm(`Apakah Anda yakin ingin menghapus template "${template.nama}"?`)) {
                        return;
                    }
                    
                    this.loading = true;
                    try {
                        const response = await this.apiCall('deleteTemplate', { id: template.id });
                        
                        if (response.status === 'success') {
                            this.showNotification('Template berhasil dihapus', 'success');
                            await this.loadTemplates();
                        } else {
                            throw new Error(response.message || 'Failed to delete template');
                        }
                    } catch (error) {
                        console.error('Error deleting template:', error);
                        this.showNotification('Gagal hapus template', 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // Cancel edit template
                cancelEditTemplate() {
                    this.currentEditingTemplate = null;
                    this.editTemplateForm = {
                        id: '',
                        nama: '',
                        kategori: '',
                        variables: '',
                        content: '',
                        deskripsi: '',
                        status: 'Aktif',
                        file: null
                    };
                    this.currentPage = 'template-list';
                },
                
                // Reset template form
                resetTemplateForm() {
                    this.templateForm = {
                        nama: '',
                        kategori: '',
                        variables: '',
                        content: '',
                        deskripsi: '',
                        status: 'Aktif',
                        file: null
                    };
                },
                
                // Handle template file upload
                handleTemplateFileUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        this.templateForm.file = file;
                        this.showNotification(`File ${file.name} diupload`, 'success');
                    }
                },
                
                // Handle edit template file upload
                handleEditTemplateFileUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        this.editTemplateForm.file = file;
                        this.showNotification(`File ${file.name} diupload`, 'success');
                    }
                },
                
                // Load template dari Google Docs
                async loadTemplate() {
                    if (!this.suratForm.template) {
                        this.resetForm();
                        return;
                    }

                    try {
                        this.loading = true;
                        const response = await this.apiCall('getTemplateContent', {
                            templateId: this.suratForm.template
                        });

                        if (response.status === 'success') {
                            // Load template content dari Google Doc
                            this.suratForm.isi = response.data.content;
                            
                            // Set perihal dari nama template
                            const selectedTemplate = this.suratTemplates.find(t => t.id === this.suratForm.template);
                            if (selectedTemplate) {
                                this.suratForm.perihal = selectedTemplate.nama;
                            }

                            // Reset nomor surat saat ganti template
                            this.suratForm.noSurat = '';
                            
                            console.log('Template loaded:', selectedTemplate.nama);
                            this.showNotification('Template berhasil dimuat', 'success');
                        } else {
                            this.showNotification('Gagal memuat template: ' + response.message, 'error');
                        }
                    } catch (error) {
                        console.error('Error loading template:', error);
                        
                        // Fallback: use template content from local data
                        const selectedTemplate = this.suratTemplates.find(t => t.id === this.suratForm.template);
                        if (selectedTemplate) {
                            this.suratForm.isi = selectedTemplate.content;
                            this.suratForm.perihal = selectedTemplate.nama;
                            this.suratForm.noSurat = '';
                            
                            console.log('Template loaded from fallback:', selectedTemplate.nama);
                            this.showNotification('Template dimuat dari data lokal', 'warning');
                        }
                    } finally {
                        this.loading = false;
                    }
                },
                
                // Generate nomor surat
                async generateNomorSurat() {
                    if (!this.suratForm.kodeArsip || !this.suratForm.tanggal) {
                        this.showNotification('Pilih kode arsip dan tanggal terlebih dahulu', 'warning');
                        return;
                    }
                    
                    this.loading = true;
                    try {
                        const response = await this.apiCall('generateNomorSurat', {
                            kodeArsip: this.suratForm.kodeArsip,
                            tanggal: this.suratForm.tanggal
                        });
                        
                        if (response.status === 'success') {
                            this.suratForm.noSurat = response.nomorSurat;
                            this.showNotification('Nomor surat berhasil dibuat', 'success');
                        } else {
                            throw new Error(response.message || 'Failed to generate nomor surat');
                        }
                    } catch (error) {
                        console.error('Error generating nomor surat:', error);
                        // Fallback: generate locally
                        this.suratForm.noSurat = this.generateNomorSuratFallback();
                        this.showNotification('Nomor surat dibuat (mode offline)', 'warning');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // Fallback nomor surat generator
                generateNomorSuratFallback() {
                    const bulanRomawi = ['I', 'II', 'III', 'IV', 'V', 'VI', 'VII', 'VIII', 'IX', 'X', 'XI', 'XII'];
                    const date = new Date(this.suratForm.tanggal);
                    const bulan = bulanRomawi[date.getMonth()];
                    const tahun = date.getFullYear();
                    const nomorUrut = Math.floor(Math.random() * 999) + 1;
                    const nomorFormatted = nomorUrut.toString().padStart(3, '0');
                    
                    return `${this.suratForm.kodeArsip}/${nomorFormatted}/SDN.005.TPTM/${bulan}/${tahun}`;
                },
                
                // Save surat
                async saveSurat() {
                    if (!this.suratForm.template || !this.suratForm.noSurat) {
                        this.showNotification('Lengkapi form terlebih dahulu', 'error');
                        return;
                    }
                    
                    this.loading = true;
                    try {
                        const response = await this.apiCall('createSuratKeluar', this.suratForm);
                        
                        if (response.status === 'success') {
                            this.showNotification('Surat berhasil disimpan ke agenda', 'success');
                            this.resetForm();
                        } else {
                            throw new Error(response.message || 'Failed to save surat');
                        }
                    } catch (error) {
                        console.error('Error saving surat:', error);
                        this.showNotification('Gagal menyimpan surat. Silakan coba lagi.', 'error');
                    } finally {
                        this.loading = false;
                    }
                },
                
                // Print surat
                printSurat() {
                    if (!this.suratForm.noSurat) {
                        this.showNotification('Generate nomor surat terlebih dahulu', 'warning');
                        return;
                    }
                    
                    window.print();
                },
                
                // Handle file upload
                handleFileUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        this.suratForm.file = file;
                        this.showNotification(`File ${file.name} diupload`, 'success');
                    }
                },
                
                // Reset form
                resetForm() {
                    this.suratForm = {
                        template: '',
                        kodeArsip: '',
                        noSurat: '',
                        tanggal: '',
                        perihal: '',
                        tujuan: '',
                        namaKegiatan: '',
                        waktu: '',
                        tempat: '',
                        isi: '',
                        file: null
                    };
                },
                
                // Show notification
                showNotification(message, type = 'info') {
                    this.notification = {
                        show: true,
                        message: message,
                        type: type
                    };
                    
                    setTimeout(() => {
                        this.notification.show = false;
                    }, 3000);
                },
                
                // Logout
                logout() {
                    if (confirm('Apakah Anda yakin ingin keluar?')) {
                        window.location.href = 'login.html';
                    }
                }
            }
        }
    </script>
</body>
</html>
